{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/mohammedvepari/Documents/Algoma%20University/Fall%202025/COSC%204086/move-y-splash-new/src/app/components/ChatInterface.tsx"],"sourcesContent":["/* Mohammed Vepari\nID: 5145543\nTuesday November 11th 2025\n*/\n\n'use client';\n\nimport { useState, useEffect, useRef, useMemo, useCallback } from 'react';\nimport * as Ably from 'ably';\nimport { ChatClient, OrderBy, ChatMessageEventType } from '@ably/chat';\nimport type {\n  ChatMessageEvent,\n  ConnectionStatusChange,\n  Message as AblyChatMessage,\n  Room,\n  RoomStatusChange,\n} from '@ably/chat';\nimport { Avatar, AvatarFallback, AvatarImage } from './ui/avatar';\nimport { Button } from './ui/button';\nimport { Input } from './ui/input';\nimport { Card } from './ui/card';\nimport { Popover, PopoverContent, PopoverTrigger } from './ui/popover';\nimport { \n  Send, \n  Image as ImageIcon, \n  Smile, \n  MoreVertical,\n  Phone,\n  Video,\n  Search,\n  Plus,\n  Paperclip,\n  Timer,\n  Camera,\n  Star,\n  File,\n  Download,\n  Play,\n  Pause\n} from 'lucide-react';\nimport { ScrollArea } from './ui/scroll-area';\nimport { toast } from 'sonner';\nimport { ImageWithFallback } from './figma/ImageWithFallback';\nimport { MessageInspiration } from './MessageInspiration';\nimport { VoiceRecorder } from './VoiceRecorder';\nimport { useUser } from '../utils/userContext';\nimport type { UserData } from '../utils/userContext';\nimport { projectId, publicAnonKey } from '../utils/supabase/info';\n\ninterface Message {\n  id: string;\n  chatId: string;\n  senderId: string;\n  content: string;\n  timestamp: string;\n  senderName?: string;\n  senderAvatar?: string;\n  image?: string;\n  file?: {\n    name: string;\n    url: string;\n    type: string;\n    size: number;\n  };\n  voice?: {\n    url: string;\n    duration: number;\n    mimeType?: string;\n    id?: string;\n  };\n  isSnapStyle?: boolean;\n  expiresIn?: number;\n  isStarred?: boolean;\n}\n\ninterface Chat {\n  identity: string;\n  chatName: string;\n  avatar: string;\n  lastMessage: string;\n  lastMessageTime: string;\n  members: string[];\n  isGroup: boolean;\n}\n\ntype VoicePlayerEntry = {\n  audio: HTMLAudioElement;\n  source: string;\n  objectUrl?: string;\n};\n\ninterface ChatInterfaceProps {\n  onStartCall?: (type: 'audio' | 'video') => void;\n  shareDraft?: string | null;\n  onShareDraftConsumed?: () => void;\n  focusUserId?: string | null;\n  onFocusUserConsumed?: () => void;\n}\n\nconst ABLY_KEY =\n  process.env.NEXT_PUBLIC_ABLY_KEY ??\n  'TWe31g.j0F01A:-j8adkUcs-AeusvKPMgSFCJKlMb8zCh1pGbt5Zo3CxI';\nconst DEFAULT_ROOM_ID = 'getting-started';\nconst VOICE_UPLOAD_ENDPOINT = '/api/voice';\nconst SUPABASE_FUNCTION_BASE = `https://${projectId}.supabase.co/functions/v1/make-server-a14c7986`;\nconst AUTH_HEADER = `Bearer ${publicAnonKey}`;\nconst JSON_AUTH_HEADERS = {\n  'Content-Type': 'application/json',\n  Authorization: AUTH_HEADER,\n};\n\nconst avatarForId = (id: string) =>\n  `https://api.dicebear.com/7.x/avataaars/svg?seed=${encodeURIComponent(id || 'user')}`;\n\nconst dataUrlToBlob = (dataUrl: string): Blob => {\n  const [header, base64] = dataUrl.split(',');\n  if (!base64) {\n    throw new Error('Error: cannot load data');\n  }\n\n  const mimeMatch = header.match(/^data:(.*?)(;base64)?$/);\n  const mimeType = mimeMatch?.[1] ?? 'application/octet-stream';\n  const binary = atob(base64);\n  const numberOfBinary = new Uint8Array(binary.length);\n  for (let i = 0; i < binary.length; i += 1) {\n    numberOfBinary[i] = binary.charCodeAt(i);\n  }\n  return new Blob([numberOfBinary], { type: mimeType });\n};\n\nexport function ChatInterface({ onStartCall, shareDraft, onShareDraftConsumed, focusUserId = null, onFocusUserConsumed }: ChatInterfaceProps) {\n  const { currentUser, allUsers } = useUser();\n  const fallbackClientIdRef = useRef<string>('');\n  if (!fallbackClientIdRef.current) {\n    fallbackClientIdRef.current = `guest-${Math.random().toString(36).slice(2, 10)}`;\n  }\n  const fallbackClientId = fallbackClientIdRef.current!;\n  const ablyClientId = currentUser?.ablyClientId ?? fallbackClientId;\n  const appUserId = currentUser?.id ?? ablyClientId;\n\n  const ablyClientRef = useRef<Ably.Realtime | null>(null);\n  const chatClientRef = useRef<ChatClient | null>(null);\n  const activeRoomRef = useRef<Room | null>(null);\n  const messageSubscriptionRef = useRef<(() => void) | null>(null);\n  const connectionStatusUnsubRef = useRef<(() => void) | null>(null);\n  const roomStatusUnsubRef = useRef<(() => void) | null>(null);\n  const snapTimeoutsRef = useRef<Map<string, ReturnType<typeof setTimeout>>>(new Map());\n  const persistedMessageIdsRef = useRef<Set<string>>(new Set());\n\n  const clearSnapTimeouts = useCallback(() => {\n    snapTimeoutsRef.current.forEach((timeout) => clearTimeout(timeout));\n    snapTimeoutsRef.current.clear();\n  }, []);\n\n  const mapStoredChatRecord = useCallback((record: unknown): Chat => {\n    const data =\n      typeof record === 'object' && record !== null ? (record as Record<string, unknown>) : {};\n\n    const idValue = data['id'];\n    const identity =\n      typeof idValue === 'string' && idValue.trim().length > 0 ? idValue : DEFAULT_ROOM_ID;\n\n    const nameValue = data['name'];\n    const avatarValue = data['avatar'];\n    const lastMessageValue = data['lastMessage'];\n    const lastMessageTimeValue = data['lastMessageTime'];\n    const membersValue = data['members'];\n    const isGroupValue = data['isGroup'];\n\n    return {\n      identity,\n      chatName:\n        typeof nameValue === 'string' && nameValue.trim().length > 0 ? nameValue : 'Chat',\n      avatar:\n        typeof avatarValue === 'string' && avatarValue.trim().length > 0\n          ? avatarValue\n          : avatarForId(identity),\n      lastMessage:\n        typeof lastMessageValue === 'string' ? lastMessageValue : '',\n      lastMessageTime:\n        typeof lastMessageTimeValue === 'string' ? lastMessageTimeValue : '',\n      members: Array.isArray(membersValue)\n        ? membersValue.filter((member): member is string => typeof member === 'string')\n        : [],\n      isGroup: Boolean(isGroupValue),\n    };\n  }, []);\n\n  const mapStoredMessageRecord = useCallback((record: unknown, roomId: string): Message => {\n    const data =\n      typeof record === 'object' && record !== null ? (record as Record<string, unknown>) : {};\n\n    const idValue = data['identity'];\n    const timestampValue = data['timestamp'];\n    const senderIdValue = data['senderId'];\n    const senderNameValue = data['senderName'];\n    const senderAvatarValue = data['senderAvatar'];\n    const contentValue = data['content'];\n    const imageValue = data['image'];\n    const fileValue = data['file'];\n    const voiceValue = data['voice'];\n    const isSnapValue = data['isSnapStyle'];\n    const expiresRaw = data['expiresIn'];\n    const isStarredValue = data['isStarred'];\n\n    const baseId =\n      typeof idValue === 'string' && idValue.trim().length > 0\n        ? idValue\n        : `${roomId}-${timestampValue ?? Date.now()}`;\n\n    let expiresIn: number | undefined;\n    if (typeof expiresRaw === 'number') {\n      expiresIn = expiresRaw;\n    } else if (typeof expiresRaw === 'string' && expiresRaw.trim().length > 0) {\n      const parsed = Number(expiresRaw);\n      if (!Number.isNaN(parsed)) {\n        expiresIn = parsed;\n      }\n    }\n\n    const timestamp =\n      typeof timestampValue === 'string' && timestampValue\n        ? timestampValue\n        : new Date().toISOString();\n\n    const image =\n      typeof imageValue === 'string' && imageValue.trim().length > 0 ? imageValue : undefined;\n\n    const file =\n      fileValue && typeof fileValue === 'object' && fileValue !== null\n        ? ({\n            name:\n              typeof (fileValue as Record<string, unknown>)['name'] === 'string'\n                ? ((fileValue as Record<string, unknown>)['name'] as string)\n                : 'file',\n            url:\n              typeof (fileValue as Record<string, unknown>)['url'] === 'string'\n                ? ((fileValue as Record<string, unknown>)['url'] as string)\n                : '',\n            type:\n              typeof (fileValue as Record<string, unknown>)['type'] === 'string'\n                ? ((fileValue as Record<string, unknown>)['type'] as string)\n                : '',\n            size: Number((fileValue as Record<string, unknown>)['size'] ?? 0),\n          } satisfies Message['file'])\n        : undefined;\n\n    const voice =\n      voiceValue && typeof voiceValue === 'object' && voiceValue !== null\n        ? ({\n            url:\n              typeof (voiceValue as Record<string, unknown>)['url'] === 'string'\n                ? ((voiceValue as Record<string, unknown>)['url'] as string)\n                : '',\n            duration: Number((voiceValue as Record<string, unknown>)['duration'] ?? 0),\n            mimeType:\n              typeof (voiceValue as Record<string, unknown>)['mimeType'] === 'string'\n                ? ((voiceValue as Record<string, unknown>)['mimeType'] as string)\n                : undefined,\n            id:\n              typeof (voiceValue as Record<string, unknown>)['id'] === 'string'\n                ? ((voiceValue as Record<string, unknown>)['id'] as string)\n                : undefined,\n          } satisfies Message['voice'])\n        : undefined;\n\n    return {\n      id: baseId,\n      chatId: roomId,\n      senderId:\n        typeof senderIdValue === 'string' && senderIdValue.trim().length > 0\n          ? senderIdValue\n          : 'unknown',\n      senderName:\n        typeof senderNameValue === 'string' && senderNameValue.trim().length > 0\n          ? senderNameValue\n          : undefined,\n      senderAvatar:\n        typeof senderAvatarValue === 'string' && senderAvatarValue.trim().length > 0\n          ? senderAvatarValue\n          : undefined,\n      content: typeof contentValue === 'string' ? contentValue : '',\n      timestamp,\n      image,\n      file,\n      voice,\n      isSnapStyle: Boolean(isSnapValue),\n      expiresIn,\n      isStarred: Boolean(isStarredValue),\n    };\n  }, []);\n\n  const userDirectory = useMemo(() => {\n    const directory = new Map<string, UserData>();\n    allUsers.forEach((user) => {\n      const key = user.ablyClientId ?? user.id;\n      directory.set(key, user);\n    });\n    return directory;\n  }, [allUsers]);\n\n  const defaultChat = useMemo<Chat>(\n    () => ({\n      identity: DEFAULT_ROOM_ID,\n      chatName: 'Getting Started',\n      avatar: avatarForId(DEFAULT_ROOM_ID),\n      lastMessage: '',\n      lastMessageTime: '',\n      members: [ablyClientId],\n      isGroup: true,\n    }),\n    [ablyClientId],\n  );\n\n  const summarizeMessage = useCallback((message: Message) => {\n    if (message.content && message.content.trim().length > 0) {\n      return message.content.trim();\n    }\n    if (message.image) {\n      return 'ðŸ“¸ Photo';\n    }\n    if (message.file) {\n      return `ðŸ“Ž ${message.file.name}`;\n    }\n    if (message.voice) {\n      return 'ðŸŽ¤ Voice message';\n    }\n    return '';\n  }, []);\n\n  const [selectedChat, setSelectedChat] = useState<string | null>(defaultChat.identity);\n  const [newMessage, setNewMessage] = useState('');\n  const [searchQuery, setSearchQuery] = useState('');\n  const [showEmojiPicker, setShowEmojiPicker] = useState(false);\n  const [isSnapMode, setIsSnapMode] = useState(false);\n  const [snapTimer, setSnapTimer] = useState<number>(10);\n  const [showNewChatDialog, setShowNewChatDialog] = useState(false);\n  const [newChatName, setNewChatName] = useState('');\n  const [newChatMembers, setNewChatMembers] = useState('');\n  const [isGroupChat, setIsGroupChat] = useState(false);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const documentInputRef = useRef<HTMLInputElement>(null);\n  const messageInputRef = useRef<HTMLInputElement>(null);\n  const messagesEndRef = useRef<HTMLDivElement>(null);\n  const audioPlayers = useRef<Record<string, VoicePlayerEntry>>({});\n  const [playingVoice, setPlayingVoice] = useState<string | null>(null);\n  const [starredMessages, setStarredMessages] = useState<Set<string>>(new Set());\n  const [messages, setMessages] = useState<Message[]>([]);\n  const [chats, setChats] = useState<Chat[]>([defaultChat]);\n  const chatsRef = useRef(chats);\n\n  useEffect(() => {\n    chatsRef.current = chats;\n  }, [chats]);\n\n  const [loading, setLoading] = useState(true);\n  const [sending, setSending] = useState(false);\n  const [ablyError, setAblyError] = useState<string | null>(null);\n  const [chatReady, setChatReady] = useState(false);\n  const [connectionStatus, setConnectionStatus] = useState<string>('connecting');\n  const [roomStatus, setRoomStatus] = useState<string>('idle');\n\n  const ensureDirectChat = useCallback(\n    async (targetUserId: string): Promise<string | null> => {\n      const friend = allUsers.get(targetUserId) ?? null;\n      const targetClientId = friend?.ablyClientId ?? targetUserId;\n      if (!targetClientId) {\n        toast.error('Unable to open conversation for that user.');\n        return null;\n      }\n\n      const memberIds = Array.from(new Set([ablyClientId, targetClientId].filter(Boolean))) as string[];\n\n      const existing = chatsRef.current.find(\n        (chat) =>\n          !chat.isGroup && memberIds.every((member) => chat.members.includes(member)),\n      );\n      if (existing) {\n        return existing.identity;\n      }\n\n      const displayName = friend?.name ?? friend?.username ?? `Chat with ${targetUserId.slice(0, 6)}`;\n\n      let persistedChat: Chat | null = null;\n      let savedToServer = false;\n\n      try {\n        const response = await fetch(`${SUPABASE_FUNCTION_BASE}/chats`, {\n          method: 'POST',\n          headers: { ...JSON_AUTH_HEADERS },\n          body: JSON.stringify({\n            name: displayName,\n            members: memberIds,\n            isGroup: false,\n            createdBy: appUserId ?? ablyClientId,\n          }),\n        });\n\n        if (response.ok) {\n          const payload = (await response.json()) as Record<string, unknown>;\n          const chatRecord = payload['chat'];\n          if (chatRecord) {\n            persistedChat = mapStoredChatRecord(chatRecord);\n            savedToServer = true;\n          }\n        } else if (response.status !== 409) {\n          throw new Error(`Failed to persist chat (status ${response.status})`);\n        }\n      } catch (error) {\n        console.warn('Unable to persist direct chat', error);\n      }\n\n      if (!persistedChat) {\n        const sortedKey = memberIds.slice().sort().join('-');\n        const fallbackId = chatsRef.current.some((chat) => chat.identity === sortedKey)\n          ? `${sortedKey}-${Date.now().toString(36)}`\n          : sortedKey;\n\n        persistedChat = {\n          identity: fallbackId,\n          chatName: displayName,\n          avatar: friend?.avatar ?? avatarForId(targetClientId),\n          lastMessage: '',\n          lastMessageTime: '',\n          members: memberIds,\n          isGroup: false,\n        };\n      }\n\n      setChats((prev) => {\n        const map = new Map(prev.map((chat) => [chat.identity, chat]));\n        map.set(persistedChat!.identity, persistedChat!);\n        const next = Array.from(map.values());\n        next.sort((a, b) => {\n          const aTime = a.lastMessageTime ? new Date(a.lastMessageTime).getTime() : 0;\n          const bTime = b.lastMessageTime ? new Date(b.lastMessageTime).getTime() : 0;\n          return bTime - aTime;\n        });\n        return next;\n      });\n\n      const client = chatClientRef.current;\n      if (client) {\n        client.rooms.get(persistedChat.identity).catch((error) => {\n          console.warn('Unable to ensure Ably room exists', error);\n        });\n      }\n\n      if (savedToServer) {\n        toast.success(`Chat created with ${friend?.name ?? 'friend'}!`);\n      }\n\n      return persistedChat.identity;\n    },\n    [allUsers, ablyClientId, appUserId, mapStoredChatRecord],\n  );\n\n  const ensureDirectChatRef = useRef(ensureDirectChat);\n  useEffect(() => {\n    ensureDirectChatRef.current = ensureDirectChat;\n  }, [ensureDirectChat]);\n\n  useEffect(() => {\n    if (!focusUserId) {\n      return;\n    }\n    if (!chatReady) {\n      return;\n    }\n\n    let cancelled = false;\n\n    const openChat = async () => {\n      try {\n        const chatId = await ensureDirectChatRef.current?.(focusUserId);\n        if (!chatId || cancelled) {\n          return;\n        }\n        setSelectedChat(chatId);\n        onFocusUserConsumed?.();\n      } catch (error) {\n        console.error('Error:', error);\n        toast.error('Unable to connect, try again later.');\n      }\n    };\n\n    void openChat();\n\n    return () => {\n      cancelled = true;\n    };\n  }, [focusUserId, chatReady, onFocusUserConsumed]);\n\n  const getSenderProfile = useCallback(\n    () => ({\n      id: ablyClientId ?? 'guest',\n      name: currentUser?.name ?? currentUser?.username ?? appUserId ?? 'Guest',\n      username: currentUser?.username,\n      avatar:\n        currentUser?.avatar ?? (ablyClientId ? avatarForId(ablyClientId) : undefined),\n    }),\n    [ablyClientId, appUserId, currentUser?.name, currentUser?.username, currentUser?.avatar],\n  );\n\n  const buildMetadata = useCallback(\n    (extra: Record<string, unknown> = {}) => {\n      const senderProfile = getSenderProfile();\n      const metadata: Record<string, unknown> = {\n        ...extra,\n        sender: {\n          id: senderProfile.id,\n          name: senderProfile.name,\n          username: senderProfile.username,\n          avatar: senderProfile.avatar,\n        },\n      };\n\n      if (isSnapMode) {\n        metadata.isSnapStyle = true;\n        metadata.expiresIn = snapTimer;\n      }\n\n      return metadata;\n    },\n    [getSenderProfile, isSnapMode, snapTimer],\n  );\n\n  const uploadVoiceClip = useCallback(async (dataUrl: string, mimeType?: string, duration?: number) => {\n    try {\n      const response = await fetch(VOICE_UPLOAD_ENDPOINT, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          dataUrl,\n          mimeType,\n          duration,\n        }),\n      });\n\n      if (!response.ok) {\n        const errorBody = await response.text();\n        throw new Error(`Cannot upload audio: (${response.status}): ${errorBody}`);\n      }\n\n      const payload: {\n        id: string;\n        url: string;\n        mimeType?: string;\n        duration?: number | null;\n      } = await response.json();\n\n      return payload;\n    } catch (error) {\n      console.error('Error uploading voice clip:', error);\n      toast.error('Failed to upload voice message');\n      return null;\n    }\n  }, []);\n\n  useEffect(() => {\n    if (!shareDraft) {\n      return;\n    }\n    setNewMessage(shareDraft);\n    setShowEmojiPicker(false);\n    onShareDraftConsumed?.();\n    messageInputRef.current?.focus();\n  }, [shareDraft, onShareDraftConsumed]);\n\n  useEffect(() => {\n    setChats((prevChats) => {\n      if (prevChats.some((chat) => chat.identity === defaultChat.identity)) {\n        return prevChats.map((chat) =>\n          chat.identity === defaultChat.identity ? { ...chat, members: defaultChat.members } : chat,\n        );\n      }\n      return [defaultChat, ...prevChats];\n    });\n  }, [defaultChat]);\n\n  useEffect(() => {\n    let cancelled = false;\n\n    const fetchPersistedChats = async () => {\n      if (!appUserId) {\n        return;\n      }\n\n      try {\n        const response = await fetch(\n          `${SUPABASE_FUNCTION_BASE}/chats/${encodeURIComponent(appUserId)}`,\n          {\n            headers: {\n              Authorization: AUTH_HEADER,\n            },\n          },\n        );\n\n        if (!response.ok) {\n          throw new Error(`Failed to load chats (${response.status})`);\n        }\n\n        const payload = (await response.json()) as Record<string, unknown>;\n        const chatsRaw = payload['chats'];\n        if (cancelled) {\n          return;\n        }\n        const serverChats = Array.isArray(chatsRaw) ? chatsRaw : [];\n        if (serverChats.length === 0) {\n          return;\n        }\n\n        setChats((prev) => {\n          const byId = new Map(prev.map((chat) => [chat.identity, chat]));\n          serverChats.forEach((record) => {\n            const mapped = mapStoredChatRecord(record);\n            byId.set(mapped.identity, mapped);\n          });\n          if (!byId.has(defaultChat.identity)) {\n            byId.set(defaultChat.identity, defaultChat);\n          }\n          return Array.from(byId.values()).sort((a, b) => {\n            const aTime = a.lastMessageTime ? new Date(a.lastMessageTime).getTime() : 0;\n            const bTime = b.lastMessageTime ? new Date(b.lastMessageTime).getTime() : 0;\n            return bTime - aTime;\n          });\n        });\n      } catch (error) {\n        console.warn('Failed to load saved chats', error);\n      }\n    };\n\n    void fetchPersistedChats();\n\n    return () => {\n      cancelled = true;\n    };\n  }, [appUserId, defaultChat, mapStoredChatRecord]);\n\n  const mapAblyMessage = useCallback(\n    (source: AblyChatMessage, roomId: string): Message => {\n      const metadata = (source.metadata ?? {}) as Record<string, unknown>;\n\n      const imageValue = metadata['image'];\n      const image = typeof imageValue === 'string' ? imageValue : undefined;\n\n      const rawFile = metadata['file'];\n      const file =\n        rawFile && typeof rawFile === 'object'\n          ? {\n              name:\n                typeof (rawFile as Record<string, unknown>).name === 'string'\n                  ? ((rawFile as Record<string, unknown>).name as string)\n                  : 'file',\n              url:\n                typeof (rawFile as Record<string, unknown>).url === 'string'\n                  ? ((rawFile as Record<string, unknown>).url as string)\n                  : '',\n              type:\n                typeof (rawFile as Record<string, unknown>).type === 'string'\n                  ? ((rawFile as Record<string, unknown>).type as string)\n                  : '',\n              size: Number((rawFile as Record<string, unknown>).size ?? 0),\n            }\n          : undefined;\n\n      const rawVoice = metadata['voice'];\n      const voice =\n        rawVoice && typeof rawVoice === 'object'\n          ? {\n              url:\n                typeof (rawVoice as Record<string, unknown>).url === 'string'\n                  ? ((rawVoice as Record<string, unknown>).url as string)\n                  : '',\n              duration: Number((rawVoice as Record<string, unknown>).duration ?? 0),\n              mimeType:\n                typeof (rawVoice as Record<string, unknown>).mimeType === 'string'\n                  ? ((rawVoice as Record<string, unknown>).mimeType as string)\n                  : undefined,\n              id:\n                typeof (rawVoice as Record<string, unknown>).id === 'string'\n                  ? ((rawVoice as Record<string, unknown>).id as string)\n                  : undefined,\n            }\n          : undefined;\n\n      const expiresInRaw = metadata['expiresIn'];\n      const expiresIn =\n        typeof expiresInRaw === 'number'\n          ? expiresInRaw\n          : typeof expiresInRaw === 'string'\n          ? Number(expiresInRaw)\n          : undefined;\n\n      const senderMeta = metadata['sender'];\n      const senderNameMeta =\n        senderMeta && typeof senderMeta === 'object'\n          ? (senderMeta as Record<string, unknown>).name\n          : undefined;\n      const senderAvatarMeta =\n        senderMeta && typeof senderMeta === 'object'\n          ? (senderMeta as Record<string, unknown>).avatar\n          : undefined;\n\n      const directoryMatch = userDirectory.get(source.clientId);\n\n      return {\n        id: source.serial,\n        chatId: roomId,\n        senderId: source.clientId,\n        content: source.text,\n        timestamp: source.timestamp.toISOString(),\n        image,\n        file,\n        voice,\n        isSnapStyle: Boolean(metadata['isSnapStyle']),\n        expiresIn: expiresIn && Number.isFinite(expiresIn) ? expiresIn : undefined,\n        isStarred: Boolean(metadata['isStarred']),\n        senderName:\n          (typeof senderNameMeta === 'string' && senderNameMeta.trim().length > 0\n            ? senderNameMeta\n            : directoryMatch?.name ?? directoryMatch?.username ?? source.clientId) ?? source.clientId,\n        senderAvatar:\n          (typeof senderAvatarMeta === 'string' && senderAvatarMeta.trim().length > 0\n            ? senderAvatarMeta\n            : directoryMatch?.avatar) ?? undefined,\n      };\n    },\n    [userDirectory],\n  );\n\n  const persistMessage = useCallback(\n    async (message: Message, options?: { force?: boolean }) => {\n      const messageId = message.id;\n      if (!messageId) {\n        return;\n      }\n      if (persistedMessageIdsRef.current.has(messageId) && !options?.force) {\n        return;\n      }\n\n      persistedMessageIdsRef.current.add(messageId);\n\n      try {\n        await fetch(`${SUPABASE_FUNCTION_BASE}/messages`, {\n          method: 'POST',\n          headers: { ...JSON_AUTH_HEADERS },\n          body: JSON.stringify({\n            id: messageId,\n            chatId: message.chatId,\n            senderId: message.senderId,\n            senderName: message.senderName ?? null,\n            senderAvatar: message.senderAvatar ?? null,\n            content: message.content ?? '',\n            image: message.image ?? null,\n            file: message.file ?? null,\n            voice: message.voice ?? null,\n            timestamp: message.timestamp,\n            isSnapStyle: message.isSnapStyle ?? false,\n            expiresIn:\n              typeof message.expiresIn === 'number' && Number.isFinite(message.expiresIn)\n                ? message.expiresIn\n                : null,\n            isStarred: message.isStarred ?? false,\n          }),\n        });\n      } catch (error) {\n        console.warn('Failed to persist message', error);\n        persistedMessageIdsRef.current.delete(messageId);\n      }\n    },\n    [],\n  );\n\n  const removePersistedMessage = useCallback(async (chatId: string, messageId: string) => {\n    if (!messageId) {\n      return;\n    }\n\n    try {\n      await fetch(\n        `${SUPABASE_FUNCTION_BASE}/messages/${encodeURIComponent(chatId)}/${encodeURIComponent(messageId)}`,\n        {\n          method: 'DELETE',\n          headers: {\n            Authorization: AUTH_HEADER,\n          },\n        },\n      );\n    } catch (error) {\n      console.warn('Failed to delete persisted message', error);\n    } finally {\n      persistedMessageIdsRef.current.delete(messageId);\n    }\n  }, []);\n\n  const handleIncomingMessage = useCallback(\n    (event: ChatMessageEvent, roomId: string) => {\n      if (event.type === ChatMessageEventType.Deleted) {\n        const timeout = snapTimeoutsRef.current.get(event.message.serial);\n        if (timeout) {\n          clearTimeout(timeout);\n          snapTimeoutsRef.current.delete(event.message.serial);\n        }\n        setMessages((prev) => prev.filter((message) => message.id !== event.message.serial));\n        void removePersistedMessage(roomId, event.message.serial);\n        return;\n      }\n\n      const mapped = mapAblyMessage(event.message, roomId);\n\n      if (mapped.isSnapStyle && mapped.expiresIn) {\n        const existingTimeout = snapTimeoutsRef.current.get(mapped.id);\n        if (existingTimeout) {\n          clearTimeout(existingTimeout);\n        }\n        const timeout = setTimeout(async () => {\n          const room = activeRoomRef.current;\n          if (!room) {\n            return;\n          }\n\n          try {\n            await room.messages.delete(event.message.serial);\n          } catch (error) {\n            console.warn('Failed to auto-delete snap message', error);\n          } finally {\n            snapTimeoutsRef.current.delete(mapped.id);\n          }\n        }, mapped.expiresIn * 1000);\n        snapTimeoutsRef.current.set(mapped.id, timeout);\n      }\n\n      setMessages((prev) => {\n        const others = prev.filter((message) => message.id !== mapped.id);\n        const next = [...others, mapped];\n        next.sort(\n          (a, b) => new Date(a.timestamp).getTime() - new Date(b.timestamp).getTime(),\n        );\n        return next;\n      });\n\n      const summary = summarizeMessage(mapped);\n      const lastMessageText = summary\n        ? (mapped.senderName ? `${mapped.senderName}: ` : '') + summary\n        : mapped.senderName ?? '';\n\n      setChats((prevChats) =>\n        prevChats.map((chat) =>\n          chat.identity === roomId\n            ? {\n                ...chat,\n                lastMessage: lastMessageText,\n                lastMessageTime: event.message.timestamp.toISOString(),\n              }\n            : chat,\n        ),\n      );\n\n      void persistMessage(mapped);\n    },\n    [mapAblyMessage, summarizeMessage, persistMessage, removePersistedMessage],\n  );\n\n  useEffect(() => {\n    if (!ABLY_KEY) {\n      setAblyError('Missing Ably configuration');\n      return;\n    }\n\n    setChatReady(false);\n    setAblyError(null);\n\n    const realtime = new Ably.Realtime({ key: ABLY_KEY, clientId: ablyClientId });\n    ablyClientRef.current = realtime;\n\n    const client = new ChatClient(realtime);\n    chatClientRef.current = client;\n    setChatReady(true);\n\n    const { off } = client.connection.onStatusChange((change: ConnectionStatusChange) => {\n      setConnectionStatus(change.current);\n    });\n    connectionStatusUnsubRef.current = off;\n\n    return () => {\n      connectionStatusUnsubRef.current?.();\n      connectionStatusUnsubRef.current = null;\n\n      messageSubscriptionRef.current?.();\n      messageSubscriptionRef.current = null;\n\n      roomStatusUnsubRef.current?.();\n      roomStatusUnsubRef.current = null;\n\n      const shutdown = async () => {\n        clearSnapTimeouts();\n        try {\n          if (activeRoomRef.current) {\n            await client.rooms.release(activeRoomRef.current.name);\n            activeRoomRef.current = null;\n          }\n        } catch (error) {\n          console.warn('Failed to release Ably room', error);\n        }\n\n        try {\n          await realtime.close();\n        } catch (error) {\n          console.warn('Failed to close Ably Realtime client', error);\n        }\n\n        if (ablyClientRef.current === realtime) {\n          ablyClientRef.current = null;\n        }\n        if (chatClientRef.current === client) {\n          chatClientRef.current = null;\n        }\n      };\n\n      void shutdown();\n    };\n  }, [ablyClientId, clearSnapTimeouts]);\n\n  useEffect(() => {\n    if (!chatReady || !selectedChat) {\n      return;\n    }\n\n    let cancelled = false;\n    const joinRoom = async () => {\n      const client = chatClientRef.current;\n      if (!client) {\n        return;\n      }\n\n      setLoading(true);\n      setAblyError(null);\n      setMessages([]);\n      persistedMessageIdsRef.current = new Set();\n\n      messageSubscriptionRef.current?.();\n      messageSubscriptionRef.current = null;\n      roomStatusUnsubRef.current?.();\n      roomStatusUnsubRef.current = null;\n\n      if (activeRoomRef.current && activeRoomRef.current.name !== selectedChat) {\n        try {\n          await client.rooms.release(activeRoomRef.current.name);\n        } catch (error) {\n          console.warn('Failed to release previous Ably room', error);\n        }\n        activeRoomRef.current = null;\n        clearSnapTimeouts();\n      }\n\n      try {\n        const room = await client.rooms.get(selectedChat);\n        activeRoomRef.current = room;\n        clearSnapTimeouts();\n\n        const { off } = room.onStatusChange((change: RoomStatusChange) => {\n          setRoomStatus(change.current);\n        });\n        roomStatusUnsubRef.current = off;\n\n        const storedById = new Map<string, Message>();\n        try {\n          const response = await fetch(\n            `${SUPABASE_FUNCTION_BASE}/messages/${encodeURIComponent(selectedChat)}`,\n            {\n              headers: {\n                Authorization: AUTH_HEADER,\n              },\n            },\n          );\n\n          if (response.ok) {\n            const payload = (await response.json()) as Record<string, unknown>;\n            const storedRecordsRaw = payload['messages'];\n            const storedRecords = Array.isArray(storedRecordsRaw) ? storedRecordsRaw : [];\n            storedRecords\n              .map((record) => mapStoredMessageRecord(record, selectedChat))\n              .forEach((message) => storedById.set(message.id, message));\n          }\n        } catch (error) {\n          console.warn('Failed to load stored messages', error);\n        }\n\n        const history = await room.messages.history({\n          orderBy: OrderBy.OldestFirst,\n          limit: 50,\n        });\n\n        const newHistoryMessages: Message[] = [];\n        history.items\n          .filter((item) => !item.isDeleted)\n          .map((item) => mapAblyMessage(item, selectedChat))\n          .forEach((message) => {\n            const existing = storedById.get(message.id);\n            if (existing) {\n              storedById.set(message.id, { ...existing, ...message });\n            } else {\n              storedById.set(message.id, message);\n              newHistoryMessages.push(message);\n            }\n          });\n\n        const combinedMessages = Array.from(storedById.values()).sort(\n          (a, b) => new Date(a.timestamp).getTime() - new Date(b.timestamp).getTime(),\n        );\n\n        persistedMessageIdsRef.current = new Set(storedById.keys());\n\n        if (!cancelled) {\n          setMessages(combinedMessages);\n          if (combinedMessages.length > 0) {\n            const last = combinedMessages[combinedMessages.length - 1];\n            const summary = summarizeMessage(last);\n            const text = summary\n              ? (last.senderName ? `${last.senderName}: ` : '') + summary\n              : last.senderName ?? '';\n            setChats((prevChats) =>\n              prevChats.map((chat) =>\n                chat.identity === selectedChat\n                  ? {\n                      ...chat,\n                      lastMessage: text,\n                      lastMessageTime: last.timestamp,\n                    }\n                  : chat,\n              ),\n            );\n          }\n        }\n\n        newHistoryMessages.forEach((message) => {\n          void persistMessage(message, { force: true });\n        });\n\n        const { unsubscribe } = room.messages.subscribe((event: ChatMessageEvent) => {\n          handleIncomingMessage(event, selectedChat);\n        });\n        messageSubscriptionRef.current = unsubscribe;\n\n        await room.attach();\n        if (!cancelled) {\n          setLoading(false);\n        }\n      } catch (error) {\n        console.error('Failed to join Ably room', error);\n        if (!cancelled) {\n          setAblyError('Failed to join chat room. Please try again.');\n          setLoading(false);\n        }\n      }\n    };\n\n    void joinRoom();\n\n    return () => {\n      cancelled = true;\n    };\n  }, [\n    chatReady,\n    selectedChat,\n    handleIncomingMessage,\n    mapAblyMessage,\n    summarizeMessage,\n    clearSnapTimeouts,\n    mapStoredMessageRecord,\n    persistMessage,\n  ]);\n\n  const emojiCategories = {\n    'Smileys': ['ðŸ˜€', 'ðŸ˜ƒ', 'ðŸ˜„', 'ðŸ˜', 'ðŸ˜†', 'ðŸ˜…', 'ðŸ¤£', 'ðŸ˜‚', 'ðŸ™‚', 'ðŸ™ƒ', 'ðŸ˜‰', 'ðŸ˜Š', 'ðŸ˜‡', 'ðŸ¥°', 'ðŸ˜', 'ðŸ¤©', 'ðŸ˜˜', 'ðŸ˜—', 'ðŸ˜š', 'ðŸ˜™'],\n    'Gestures': ['ðŸ‘', 'ðŸ‘Ž', 'ðŸ‘Œ', 'âœŒï¸', 'ðŸ¤ž', 'ðŸ¤Ÿ', 'ðŸ¤˜', 'ðŸ¤™', 'ðŸ‘ˆ', 'ðŸ‘‰', 'ðŸ‘†', 'ðŸ‘‡', 'â˜ï¸', 'ðŸ‘', 'ðŸ™Œ', 'ðŸ‘', 'ðŸ¤²', 'ðŸ¤', 'ðŸ™', 'âœŠ'],\n    'Hearts': ['â¤ï¸', 'ðŸ§¡', 'ðŸ’›', 'ðŸ’š', 'ðŸ’™', 'ðŸ’œ', 'ðŸ–¤', 'ðŸ¤', 'ðŸ¤Ž', 'ðŸ’”', 'â£ï¸', 'ðŸ’•', 'ðŸ’ž', 'ðŸ’“', 'ðŸ’—', 'ðŸ’–', 'ðŸ’˜', 'ðŸ’', 'ðŸ’Ÿ', 'â™¥ï¸'],\n    'Celebration': ['ðŸŽ‰', 'ðŸŽŠ', 'ðŸŽˆ', 'ðŸŽ', 'ðŸŽ€', 'ðŸŽ‚', 'ðŸ°', 'ðŸ§', 'ðŸ¥³', 'ðŸŽ†', 'ðŸŽ‡', 'âœ¨', 'ðŸŽƒ', 'ðŸŽ„', 'ðŸŽ‹', 'ðŸŽ', 'ðŸŽŽ', 'ðŸŽ', 'ðŸŽ', 'ðŸŽ‘'],\n    'Activities': ['âš½', 'ðŸ€', 'ðŸˆ', 'âš¾', 'ðŸ¥Ž', 'ðŸŽ¾', 'ðŸ', 'ðŸ‰', 'ðŸ¥', 'ðŸŽ±', 'ðŸ“', 'ðŸ¸', 'ðŸ’', 'ðŸ‘', 'ðŸ¥', 'ðŸ', 'ðŸŽ®', 'ðŸ•¹ï¸', 'ðŸŽ²', 'ðŸŽ¯']\n  };\n\n  useEffect(() => {\n    return () => {\n      Object.values(audioPlayers.current).forEach(({ audio, objectUrl }) => {\n        audio.pause();\n        if (objectUrl) {\n          URL.revokeObjectURL(objectUrl);\n        }\n      });\n      audioPlayers.current = {};\n      clearSnapTimeouts();\n    };\n  }, [clearSnapTimeouts]);\n\n  // Auto-scroll to bottom when new messages arrive\n  useEffect(() => {\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\n  }, [messages]);\n\n  useEffect(() => {\n    if (ablyError) {\n      toast.error(ablyError);\n    }\n  }, [ablyError]);\n\n  useEffect(() => {\n    let cancelled = false;\n\n    const syncPlayers = async () => {\n      const voiceMessages = messages.filter((msg) => msg.voice?.url);\n      const currentIds = new Set(voiceMessages.map((msg) => msg.id));\n\n      Object.entries(audioPlayers.current).forEach(([id, entry]) => {\n        if (!currentIds.has(id)) {\n          entry.audio.pause();\n          entry.audio.onended = null;\n          entry.audio.onerror = null;\n          if (entry.objectUrl) {\n            URL.revokeObjectURL(entry.objectUrl);\n          }\n          delete audioPlayers.current[id];\n        }\n      });\n\n      for (const msg of voiceMessages) {\n        if (cancelled || !msg.voice?.url) {\n          continue;\n        }\n\n        const existing = audioPlayers.current[msg.id];\n        if (existing && existing.source === msg.voice.url) {\n          continue;\n        }\n\n        if (existing) {\n          existing.audio.pause();\n          existing.audio.onended = null;\n          existing.audio.onerror = null;\n          if (existing.objectUrl) {\n            URL.revokeObjectURL(existing.objectUrl);\n          }\n          delete audioPlayers.current[msg.id];\n        }\n\n        try {\n          let blob: Blob | null = null;\n\n          if (msg.voice.url.startsWith('data:')) {\n            blob = dataUrlToBlob(msg.voice.url);\n          } else {\n            const response = await fetch(msg.voice.url);\n            if (!response.ok) {\n              throw new Error(`Failed to load voice audio (${response.status})`);\n            }\n            const contentType = response.headers.get('content-type') ?? '';\n            if (contentType.includes('application/json')) {\n              const payload = await response.json();\n              if (payload?.dataUrl) {\n                blob = dataUrlToBlob(payload.dataUrl as string);\n              } else {\n                throw new Error('Voice payload missing dataUrl');\n              }\n            } else {\n              blob = await response.blob();\n            }\n          }\n\n          if (!blob) {\n            throw new Error('Unable to resolve voice blob');\n          }\n          if (cancelled) {\n            return;\n          }\n\n          const objectUrl = URL.createObjectURL(blob);\n          if (cancelled) {\n            URL.revokeObjectURL(objectUrl);\n            return;\n          }\n\n          const audio = new Audio(objectUrl);\n          audio.preload = 'auto';\n          audio.volume = 1;\n          audio.onended = () => {\n            setPlayingVoice((prev) => (prev === msg.id ? null : prev));\n          };\n          audio.onerror = (event) => {\n            console.warn('Unable to play voice message', event);\n          };\n\n          audioPlayers.current[msg.id] = {\n            audio,\n            source: msg.voice.url,\n            objectUrl,\n          };\n\n          if (playingVoice === msg.id) {\n            audio.currentTime = 0;\n            const playPromise = audio.play();\n            if (playPromise && typeof playPromise.catch === 'function') {\n              playPromise.catch((error) => {\n                console.warn('Audio playback prevented:', error);\n              });\n            }\n          }\n        } catch (error) {\n          if (cancelled) {\n            continue;\n          }\n          console.error('Failed to prepare voice message audio', error);\n        }\n      }\n    };\n\n    syncPlayers();\n\n    return () => {\n      cancelled = true;\n    };\n  }, [messages, playingVoice]);\n\n  useEffect(() => {\n    Object.entries(audioPlayers.current).forEach(([id, entry]) => {\n      const { audio } = entry;\n      if (id !== playingVoice) {\n        audio.pause();\n        audio.currentTime = 0;\n      }\n    });\n\n    if (!playingVoice) {\n      return;\n    }\n\n    const activeEntry = audioPlayers.current[playingVoice];\n    if (!activeEntry) {\n      return;\n    }\n\n    const { audio } = activeEntry;\n    if (audio.paused) {\n      audio.currentTime = 0;\n    }\n    const playAudio = () => {\n      const playPromise = audio.play();\n      if (playPromise && typeof playPromise.catch === 'function') {\n        playPromise.catch((error) => {\n          console.warn('Audio playback prevented:', error);\n        });\n      }\n    };\n\n    if (audio.readyState >= 2) {\n      playAudio();\n    } else {\n      const handleCanPlay = () => {\n        audio.removeEventListener('canplay', handleCanPlay);\n        playAudio();\n      };\n      audio.addEventListener('canplay', handleCanPlay, { once: true });\n      audio.load();\n    }\n\n    return () => {\n      audio.pause();\n    };\n  }, [playingVoice]);\n\n  const handleSendMessage = async () => {\n    if (!newMessage.trim() || !selectedChat || sending) {\n      return;\n    }\n\n    const room = activeRoomRef.current;\n    if (!room) {\n      toast.error('Chat is still connecting. Please try again.');\n      return;\n    }\n\n    setSending(true);\n    try {\n      const metadata = buildMetadata();\n\n      await room.messages.send({\n        text: newMessage,\n        metadata,\n      });\n\n      setNewMessage('');\n\n      if (isSnapMode) {\n        toast.success(`Snap sent! Disappears in ${snapTimer}s â±ï¸`);\n      } else {\n        toast.success('Message sent! ðŸ“¤');\n      }\n    } catch (error) {\n      console.error('Error sending message via Ably:', error);\n      toast.error('Failed to send message');\n    } finally {\n      setSending(false);\n    }\n  };\n\n  const handleEmojiSelect = (emoji: string) => {\n    setNewMessage(newMessage + emoji);\n  };\n\n  const handleFileUpload = async (event: React.ChangeEvent<HTMLInputElement>) => {\n    if (!selectedChat || sending) return;\n\n    const file = event.target.files?.[0];\n    const room = activeRoomRef.current;\n    if (!file) {\n      return;\n    }\n    if (!room) {\n      toast.error('Chat is still connecting. Please try again.');\n      return;\n    }\n\n    setSending(true);\n    const reader = new FileReader();\n    reader.onload = async (e) => {\n      try {\n      const metadata = buildMetadata({\n        image: e.target?.result as string,\n      });\n\n      await room.messages.send({\n        text: '',\n        metadata,\n      });\n\n        toast.success('Photo sent! ðŸ“¸');\n      } catch (error) {\n        console.error('Error sending image via Ably:', error);\n        toast.error('Failed to send image');\n      } finally {\n        setSending(false);\n        if (fileInputRef.current) {\n          fileInputRef.current.value = '';\n        }\n      }\n    };\n    reader.onerror = () => {\n      toast.error('Failed to read image file');\n      setSending(false);\n    };\n    reader.readAsDataURL(file);\n  };\n\n  const handleCreateChat = async () => {\n    const trimmedName = newChatName.trim();\n    if (!trimmedName) {\n      toast.error('Please enter a chat name');\n      return;\n    }\n\n    try {\n      const memberIds = newChatMembers\n        .split(',')\n        .map((member) => member.trim())\n        .filter((member) => member.length > 0);\n\n      const allMembers = Array.from(\n        new Set([ablyClientId, ...memberIds].filter(Boolean)),\n      ) as string[];\n      const createdBy = appUserId ?? ablyClientId;\n\n      let persistedChat: Chat | null = null;\n      let isDuplicate = false;\n      let savedToServer = false;\n\n      if (createdBy) {\n        try {\n          const response = await fetch(`${SUPABASE_FUNCTION_BASE}/chats`, {\n            method: 'POST',\n            headers: { ...JSON_AUTH_HEADERS },\n            body: JSON.stringify({\n              name: trimmedName,\n              members: allMembers,\n              isGroup: isGroupChat || allMembers.length > 2,\n              createdBy,\n            }),\n          });\n\n          if (response.ok) {\n            const payload = (await response.json()) as Record<string, unknown>;\n            const chatRecord = payload['chat'];\n            if (chatRecord !== undefined) {\n              persistedChat = mapStoredChatRecord(chatRecord);\n              isDuplicate = Boolean(payload['isDuplicate']);\n              savedToServer = true;\n            }\n          } else {\n            throw new Error(`Failed to persist chat (${response.status})`);\n          }\n        } catch (error) {\n          console.warn('Unable to persist chat, falling back to local state', error);\n        }\n      }\n\n      if (!persistedChat) {\n        const slugBase = trimmedName\n          .toLowerCase()\n          .replace(/[^a-z0-9]+/g, '-')\n          .replace(/^-+|-+$/g, '');\n        const fallbackId = `${slugBase || 'chat'}-${Date.now().toString(36)}`;\n        const roomId = chats.some((chat) => chat.identity === fallbackId)\n          ? `${fallbackId}-${Math.random().toString(36).slice(2, 8)}`\n          : fallbackId;\n\n        persistedChat = {\n          identity: roomId,\n          chatName: trimmedName,\n          avatar: avatarForId(roomId),\n          lastMessage: '',\n          lastMessageTime: '',\n          members: allMembers,\n          isGroup: isGroupChat || allMembers.length > 2,\n        };\n      }\n\n      setChats((prev) => {\n        const byId = new Map(prev.map((chat) => [chat.identity, chat]));\n        byId.set(persistedChat!.identity, persistedChat!);\n        return Array.from(byId.values()).sort((a, b) => {\n          const aTime = a.lastMessageTime ? new Date(a.lastMessageTime).getTime() : 0;\n          const bTime = b.lastMessageTime ? new Date(b.lastMessageTime).getTime() : 0;\n          return bTime - aTime;\n        });\n      });\n\n      setSelectedChat(persistedChat.identity);\n      setShowNewChatDialog(false);\n      setNewChatName('');\n      setNewChatMembers('');\n      setIsGroupChat(false);\n\n      if (isDuplicate) {\n        toast.success('Chat already exists. Opening it now!');\n      } else if (savedToServer) {\n        toast.success('Chat created and saved! ðŸŽ‰');\n      } else {\n        toast.success('Chat created! ðŸŽ‰');\n      }\n\n      const client = chatClientRef.current;\n      if (client) {\n        client.rooms.get(persistedChat.identity).catch((error) => {\n          console.warn('Unable to start chat room', error);\n        });\n      }\n    } catch (error) {\n      console.error('Error creating chat:', error);\n      toast.error('Chat has not been created');\n    }\n  };\n\n  const handleCall = (type: 'audio' | 'video') => {\n    const currentChat = chats.find(chat => chat.identity === selectedChat);\n    toast.success(`Starting ${type} call with ${currentChat?.chatName}...`);\n    if (onStartCall) {\n      onStartCall(type);\n    }\n  };\n\n  const handleDocumentUpload = async (event: React.ChangeEvent<HTMLInputElement>) => {\n    if (!selectedChat || sending) return;\n\n    const file = event.target.files?.[0];\n    const room = activeRoomRef.current;\n    if (!file) {\n      return;\n    }\n    if (!room) {\n      toast.error('Chat is still connecting. Please try again.');\n      return;\n    }\n\n    setSending(true);\n    const reader = new FileReader();\n    reader.onload = async (e) => {\n      try {\n        const metadata = buildMetadata({\n          file: {\n            name: file.name,\n            url: e.target?.result as string,\n            type: file.type,\n            size: file.size,\n          },\n        });\n\n        await room.messages.send({\n          text: '',\n          metadata,\n        });\n\n        toast.success('File sent! ðŸ“Ž');\n      } catch (error) {\n        console.error('Error sending file via Ably:', error);\n        toast.error('Failed to send file');\n      } finally {\n        setSending(false);\n        if (documentInputRef.current) {\n          documentInputRef.current.value = '';\n        }\n      }\n    };\n    reader.onerror = () => {\n      toast.error('Failed to read file');\n      setSending(false);\n    };\n    reader.readAsDataURL(file);\n  };\n\n  const handleVoiceSend = async (audioData: string, duration: number, mimeType?: string) => {\n    if (!selectedChat || sending) return;\n\n    const room = activeRoomRef.current;\n    if (!room) {\n      toast.error('Chat is still connecting. Please try again.');\n      return;\n    }\n\n    setSending(true);\n    try {\n      const uploadResult = await uploadVoiceClip(audioData, mimeType, duration);\n      if (!uploadResult) {\n        return;\n      }\n\n      const voiceMetadata: Record<string, unknown> = {\n        url: uploadResult.url,\n        duration,\n      };\n      if (uploadResult.mimeType || mimeType) {\n        voiceMetadata.mimeType = uploadResult.mimeType ?? mimeType;\n      }\n      if (uploadResult.id) {\n        voiceMetadata.id = uploadResult.id;\n      }\n\n      const metadata = buildMetadata({\n        voice: voiceMetadata,\n      });\n\n      await room.messages.send({\n        text: '',\n        metadata,\n      });\n\n      toast.success('Voice message sent! ðŸŽ¤');\n    } catch (error) {\n      console.error('Error sending voice message via Ably:', error);\n      toast.error('Failed to send voice message');\n    } finally {\n      setSending(false);\n    }\n  };\n\n  const handleToggleStar = async (messageId: string) => {\n    const message = messages.find(m => m.id === messageId);\n    if (!message) return;\n\n    const newStarred = new Set(starredMessages);\n    const willBeStarred = !newStarred.has(messageId);\n    \n    if (willBeStarred) {\n      newStarred.add(messageId);\n      toast.success('Message starred! â­');\n    } else {\n      newStarred.delete(messageId);\n      toast.success('Message unstarred');\n    }\n    setStarredMessages(newStarred);\n    \n    // Update message starred status locally\n    setMessages((msgs) => msgs.map(msg => \n      msg.id === messageId ? { ...msg, isStarred: willBeStarred } : msg\n    ));\n\n    try {\n      await fetch(\n        `${SUPABASE_FUNCTION_BASE}/messages/${encodeURIComponent(message.chatId)}/${encodeURIComponent(messageId)}/star`,\n        {\n          method: 'PUT',\n          headers: { ...JSON_AUTH_HEADERS },\n          body: JSON.stringify({ isStarred: willBeStarred }),\n        },\n      );\n    } catch (error) {\n      console.warn('Failed to persist starring change', error);\n    }\n  };\n\n  const handlePlayVoice = (messageId: string) => {\n    if (playingVoice === messageId) {\n      setPlayingVoice(null);\n      return;\n    }\n\n    const entry = audioPlayers.current[messageId];\n    if (!entry) {\n      setPlayingVoice(messageId);\n      return;\n    }\n\n    Object.entries(audioPlayers.current).forEach(([id, other]) => {\n      if (id !== messageId) {\n        other.audio.pause();\n        other.audio.currentTime = 0;\n      }\n    });\n    entry.audio.currentTime = 0;\n    const playPromise = entry.audio.play();\n    if (playPromise && typeof playPromise.catch === 'function') {\n      playPromise.catch((error) => {\n        console.warn('Audio playback prevented:', error);\n      });\n    }\n    setPlayingVoice(messageId);\n  };\n\n  const connectionHealthy =\n    connectionStatus === 'connected' && roomStatus === 'attached';\n  const connectionSummary = connectionHealthy\n    ? 'Live'\n    : `Status: ${connectionStatus} / ${roomStatus}`;\n\n  const currentChat = chats.find(chat => chat.identity === selectedChat);\n  const quickEmojis = ['ðŸ˜Š', 'â¤ï¸', 'ðŸ”¥', 'ðŸ‘', 'ðŸ˜‚', 'ðŸŽ‰', 'âœ¨', 'ðŸ’¯'];\n\n  const filteredChats = chats.filter(chat =>\n    chat.chatName.toLowerCase().includes(searchQuery.toLowerCase())\n  );\n\n  if (loading) {\n    return (\n      <div className=\"h-[calc(100vh-80px)] flex items-center justify-center\">\n        <div className=\"text-white text-xl\">Loading messages... ðŸ’¬</div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"h-[calc(100vh-80px)] min-h-0 flex gap-6 max-w-7xl mx-auto\">\n      {/* Chat List Sidebar */}\n      <Card className=\"w-96 min-h-0 backdrop-blur-xl bg-white/10 border-white/20 flex flex-col overflow-hidden\">\n        {/* Search Header */}\n        <div className=\"p-4 border-b border-white/10\">\n          <div className=\"flex items-center justify-between mb-4\">\n            <h2 className=\"text-white text-xl\">Messages</h2>\n            <Button \n              size=\"sm\"\n              onClick={() => setShowNewChatDialog(!showNewChatDialog)}\n              className=\"bg-gradient-to-r from-pink-500 to-purple-500 hover:from-pink-600 hover:to-purple-600 text-white border-0\"\n            >\n              <Plus className=\"w-4 h-4\" />\n            </Button>\n          </div>\n\n          {/* New Chat Dialog */}\n          {showNewChatDialog && (\n            <div className=\"mb-4 p-4 bg-white/10 rounded-lg space-y-3\">\n              <Input\n                placeholder=\"Chat name...\"\n                value={newChatName}\n                onChange={(e) => setNewChatName(e.target.value)}\n                className=\"bg-white/5 border-white/20 text-white placeholder:text-white/50\"\n              />\n              <Input\n                placeholder=\"Member IDs (comma separated)...\"\n                value={newChatMembers}\n                onChange={(e) => setNewChatMembers(e.target.value)}\n                className=\"bg-white/5 border-white/20 text-white placeholder:text-white/50\"\n              />\n              <div className=\"flex gap-2\">\n                <Button\n                  size=\"sm\"\n                  onClick={handleCreateChat}\n                  className=\"flex-1 bg-gradient-to-r from-pink-500 to-purple-500 hover:from-pink-600 hover:to-purple-600 text-white border-0\"\n                >\n                  Create\n                </Button>\n                <Button\n                  size=\"sm\"\n                  variant=\"ghost\"\n                  onClick={() => setShowNewChatDialog(false)}\n                  className=\"text-white/70 hover:text-white hover:bg-white/10\"\n                >\n                  Cancel\n                </Button>\n              </div>\n            </div>\n          )}\n\n          <div className=\"relative\">\n            <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-white/50\" />\n            <Input\n              placeholder=\"Search messages...\"\n              value={searchQuery}\n              onChange={(e) => setSearchQuery(e.target.value)}\n              className=\"pl-10 bg-white/5 border-white/20 text-white placeholder:text-white/50\"\n            />\n          </div>\n        </div>\n\n        {/* Chats List */}\n        <ScrollArea className=\"flex-1 h-full overflow-y-auto\">\n          {filteredChats.length === 0 ? (\n            <div className=\"p-8 text-center text-white/50\">\n              <p className=\"mb-2\">No chats yet</p>\n              <p className=\"text-sm\">Click + to start a new conversation</p>\n            </div>\n          ) : (\n            <div className=\"p-2\">\n              {filteredChats.map((chat) => (\n                <button\n                  key={chat.identity}\n                  onClick={() => setSelectedChat(chat.identity)}\n                  className={`w-full p-3 rounded-xl mb-2 transition-all ${\n                    selectedChat === chat.identity\n                      ? 'bg-gradient-to-r from-pink-500/30 to-purple-500/30 backdrop-blur-xl'\n                      : 'hover:bg-white/10'\n                  }`}\n                >\n                  <div className=\"flex items-center gap-3\">\n                    <Avatar className=\"w-12 h-12 border-2 border-white/20\">\n                      <AvatarImage src={chat.avatar} />\n                      <AvatarFallback>{chat.chatName[0]}</AvatarFallback>\n                    </Avatar>\n                    <div className=\"flex-1 text-left overflow-hidden\">\n                      <div className=\"flex items-center justify-between\">\n                        <h3 className=\"text-white truncate\">{chat.chatName}</h3>\n                        <span className=\"text-white/40 text-xs\">\n                          {chat.lastMessageTime\n                            ? new Date(chat.lastMessageTime).toLocaleTimeString([], {\n                                hour: '2-digit',\n                                minute: '2-digit',\n                              })\n                            : '--:--'}\n                        </span>\n                      </div>\n                      <p className=\"text-white/60 text-sm truncate\">\n                        {chat.lastMessage || 'No messages yet'}\n                      </p>\n                    </div>\n                  </div>\n                </button>\n              ))}\n            </div>\n          )}\n        </ScrollArea>\n      </Card>\n\n      {/* Main Chat Area */}\n      <Card className=\"flex-1 min-h-0 backdrop-blur-xl bg-white/10 border-white/20 flex flex-col overflow-hidden\">\n        {!selectedChat || !currentChat ? (\n          <div className=\"flex-1 flex items-center justify-center\">\n            <div className=\"text-center\">\n              <h3 className=\"text-white text-2xl mb-2\">Select a chat to start messaging</h3>\n              <p className=\"text-white/60\">Choose a conversation or create a new one</p>\n            </div>\n          </div>\n        ) : (\n          <>\n            {/* Chat Header */}\n            <div className=\"p-4 border-b border-white/10 flex items-center justify-between\">\n              <div className=\"flex items-center gap-3\">\n                <Avatar className=\"w-10 h-10 border-2 border-white/20\">\n                  <AvatarImage src={currentChat.avatar} />\n                  <AvatarFallback>{currentChat.chatName[0]}</AvatarFallback>\n                </Avatar>\n                <div>\n                  <h3 className=\"text-white\">{currentChat.chatName}</h3>\n                  {currentChat.isGroup && (\n                    <p className=\"text-white/60 text-sm\">{currentChat.members.length} members</p>\n                  )}\n                  <p\n                    className={`text-sm ${\n                      connectionHealthy ? 'text-emerald-300' : 'text-white/60'\n                    }`}\n                  >\n                    {connectionSummary}\n                  </p>\n                </div>\n              </div>\n\n              <div className=\"flex items-center gap-2\">\n                <Button\n                  size=\"sm\"\n                  variant=\"ghost\"\n                  onClick={() => handleCall('audio')}\n                  className=\"text-white/70 hover:text-white hover:bg-white/10\"\n                >\n                  <Phone className=\"w-5 h-5\" />\n                </Button>\n                <Button\n                  size=\"sm\"\n                  variant=\"ghost\"\n                  onClick={() => handleCall('video')}\n                  className=\"text-white/70 hover:text-white hover:bg-white/10\"\n                >\n                  <Video className=\"w-5 h-5\" />\n                </Button>\n                <Button\n                  size=\"sm\"\n                  variant=\"ghost\"\n                  className=\"text-white/70 hover:text-white hover:bg-white/10\"\n                >\n                  <MoreVertical className=\"w-5 h-5\" />\n                </Button>\n              </div>\n            </div>\n\n            {/* Messages Area */}\n            <ScrollArea className=\"flex-1 h-full overflow-y-auto p-6\">\n              <div className=\"space-y-4\">\n                {messages.length === 0 ? (\n                  <div className=\"text-center text-white/50 py-8\">\n                    <p>No messages yet. Start the conversation! ðŸ’¬</p>\n                  </div>\n                ) : (\n                  messages.map((message) => {\n                    const isMe = message.senderId === ablyClientId;\n                    const isStarred = starredMessages.has(message.id) || message.isStarred;\n                    return (\n                      <div\n                        key={message.id}\n                        className={`flex gap-3 ${isMe ? 'flex-row-reverse' : 'flex-row'} group`}\n                      >\n                        {!isMe && (\n                          <Avatar className=\"w-8 h-8 border-2 border-white/20 flex-shrink-0\">\n                            <AvatarImage src={message.senderAvatar ?? avatarForId(message.senderId)} />\n                            <AvatarFallback>\n                              {(message.senderName ?? message.senderId ?? 'U')[0] ?? 'U'}\n                            </AvatarFallback>\n                          </Avatar>\n                        )}\n                        <div className={`flex-1 max-w-[70%] ${isMe ? 'flex flex-col items-end' : ''}`}>\n                          {!isMe && message.senderName && (\n                            <p className=\"text-xs text-white/50 mb-1\">{message.senderName}</p>\n                          )}\n                          {/* Image Message */}\n                          {message.image && (\n                            <div className={`rounded-2xl overflow-hidden mb-2 relative ${\n                              message.isSnapStyle \n                                ? 'border-4 border-yellow-400' \n                                : ''\n                            }`}>\n                              <ImageWithFallback\n                                src={message.image}\n                                alt=\"Shared image\"\n                                className=\"w-full max-w-md rounded-xl\"\n                              />\n                              {message.isSnapStyle && message.expiresIn && (\n                                <div className=\"absolute -top-2 -right-2 bg-yellow-400 text-black px-2 py-0.5 rounded-full text-xs flex items-center gap-1\">\n                                  <Timer className=\"w-3 h-3\" />\n                                  {message.expiresIn}s\n                                </div>\n                              )}\n                            </div>\n                          )}\n                          \n                          {/* File Message */}\n                          {message.file && (\n                            <div className={`rounded-2xl px-4 py-3 mb-2 ${\n                              isMe\n                                ? 'bg-gradient-to-r from-pink-500 to-purple-500 text-white'\n                                : 'bg-white/10 backdrop-blur-xl text-white'\n                            }`}>\n                              <div className=\"flex items-center gap-3\">\n                                <div className=\"w-10 h-10 bg-white/20 rounded-lg flex items-center justify-center\">\n                                  <File className=\"w-5 h-5\" />\n                                </div>\n                                <div className=\"flex-1 min-w-0\">\n                                  <p className=\"truncate\">{message.file.name}</p>\n                                  <p className=\"text-xs opacity-70\">\n                                    {(message.file.size / 1024).toFixed(2)} KB\n                                  </p>\n                                </div>\n                                <a\n                                  href={message.file.url}\n                                  download={message.file.name}\n                                  className=\"w-8 h-8 bg-white/20 hover:bg-white/30 rounded-lg flex items-center justify-center transition-colors\"\n                                >\n                                  <Download className=\"w-4 h-4\" />\n                                </a>\n                              </div>\n                            </div>\n                          )}\n\n                          {/* Voice Message */}\n                          {message.voice && (\n                            <div className={`rounded-2xl px-4 py-3 mb-2 min-w-[200px] ${\n                              isMe\n                                ? 'bg-gradient-to-r from-pink-500 to-purple-500 text-white'\n                                : 'bg-white/10 backdrop-blur-xl text-white'\n                            }`}>\n                              <div className=\"flex items-center gap-3\">\n                                <button\n                                  onClick={() => handlePlayVoice(message.id)}\n                                  className=\"w-10 h-10 bg-white/20 hover:bg-white/30 rounded-full flex items-center justify-center transition-colors\"\n                                >\n                                  {playingVoice === message.id ? (\n                                    <Pause className=\"w-5 h-5\" />\n                                  ) : (\n                                    <Play className=\"w-5 h-5 ml-0.5\" />\n                                  )}\n                                </button>\n                                <div className=\"flex-1\">\n                                  <div className=\"flex items-center gap-1 h-6\">\n                                    {Array.from({ length: 20 }).map((_, i) => (\n                                      <div\n                                        key={i}\n                                        className={`w-1 bg-white/50 rounded-full ${\n                                          playingVoice === message.id ? 'animate-pulse' : ''\n                                        }`}\n                                        style={{\n                                          height: `${Math.random() * 60 + 40}%`,\n                                          animationDelay: `${i * 50}ms`\n                                        }}\n                                      ></div>\n                                    ))}\n                                  </div>\n                                  <p className=\"text-xs opacity-70 mt-1\">\n                                    {Math.floor(message.voice.duration / 60)}:{(message.voice.duration % 60).toString().padStart(2, '0')}\n                                  </p>\n                                </div>\n                              </div>\n                            </div>\n                          )}\n\n                          {/* Text Message */}\n                          {message.content && (\n                            <div className={`rounded-2xl px-4 py-3 relative ${\n                              isMe\n                                ? message.isSnapStyle\n                                  ? 'bg-yellow-400 text-black'\n                                  : 'bg-gradient-to-r from-pink-500 to-purple-500 text-white'\n                                : 'bg-white/10 backdrop-blur-xl text-white'\n                            } ${message.isSnapStyle ? 'border-2 border-yellow-400' : ''}`}>\n                              <p className=\"break-words\">{message.content}</p>\n                              {message.isSnapStyle && message.expiresIn && (\n                                <div className=\"absolute -top-2 -right-2 bg-yellow-400 text-black px-2 py-0.5 rounded-full text-xs flex items-center gap-1\">\n                                  <Timer className=\"w-3 h-3\" />\n                                  {message.expiresIn}s\n                                </div>\n                              )}\n                            </div>\n                          )}\n\n                          {/* Message Footer with Star */}\n                          <div className=\"flex items-center gap-2 mt-1\">\n                            <div className=\"text-white/40 text-xs\">\n                              {new Date(message.timestamp).toLocaleTimeString([], { \n                                hour: '2-digit', \n                                minute: '2-digit' \n                              })}\n                            </div>\n                            <button\n                              onClick={() => handleToggleStar(message.id)}\n                              className={`opacity-0 group-hover:opacity-100 transition-opacity p-1 hover:scale-125 ${\n                                isStarred ? 'opacity-100' : ''\n                              }`}\n                            >\n                              <Star\n                                className={`w-4 h-4 ${\n                                  isStarred \n                                    ? 'fill-yellow-400 text-yellow-400' \n                                    : 'text-white/40 hover:text-white/60'\n                                }`}\n                              />\n                            </button>\n                          </div>\n                        </div>\n                      </div>\n                    );\n                  })\n                )}\n                <div ref={messagesEndRef} />\n              </div>\n            </ScrollArea>\n\n            {/* Snap Mode Toggle */}\n            <div className=\"px-6 py-2 border-t border-white/10\">\n              <div className=\"flex items-center justify-between\">\n                <div className=\"flex items-center gap-3\">\n                  <button\n                    onClick={() => setIsSnapMode(!isSnapMode)}\n                    className={`flex items-center gap-2 px-3 py-1.5 rounded-full transition-all ${\n                      isSnapMode \n                        ? 'bg-yellow-400 text-black' \n                        : 'bg-white/10 text-white/70 hover:bg-white/20'\n                    }`}\n                  >\n                    <Camera className=\"w-4 h-4\" />\n                    <span className=\"text-sm\">Snap Mode</span>\n                    {isSnapMode && <Timer className=\"w-4 h-4\" />}\n                  </button>\n                  \n                  {isSnapMode && (\n                    <div className=\"flex items-center gap-2\">\n                      <span className=\"text-white/70 text-sm\">Timer:</span>\n                      {[5, 10, 15, 30].map((seconds) => (\n                        <button\n                          key={seconds}\n                          onClick={() => setSnapTimer(seconds)}\n                          className={`px-2 py-1 rounded-lg text-xs ${\n                            snapTimer === seconds\n                              ? 'bg-yellow-400 text-black'\n                              : 'bg-white/10 text-white/70 hover:bg-white/20'\n                          }`}\n                        >\n                          {seconds}s\n                        </button>\n                      ))}\n                    </div>\n                  )}\n                </div>\n                \n                {/* Quick Emoji Reactions */}\n                <div className=\"flex gap-2\">\n                  {quickEmojis.map((emoji, index) => (\n                    <button\n                      key={index}\n                      onClick={() => handleEmojiSelect(emoji)}\n                      className=\"text-xl hover:scale-125 transition-transform\"\n                    >\n                      {emoji}\n                    </button>\n                  ))}\n                </div>\n              </div>\n            </div>\n\n            {/* Message Input Box - Redesigned with cleaner box at bottom */}\n            <div className=\"p-4\">\n              <div className=\"backdrop-blur-xl bg-white/10 border-2 border-white/20 rounded-2xl p-3\">\n                <input\n                  ref={fileInputRef}\n                  type=\"file\"\n                  accept=\"image/*\"\n                  onChange={handleFileUpload}\n                  className=\"hidden\"\n                />\n                <input\n                  ref={documentInputRef}\n                  type=\"file\"\n                  accept=\".pdf,.doc,.docx,.txt,.zip,.rar\"\n                  onChange={handleDocumentUpload}\n                  className=\"hidden\"\n                />\n                \n                {/* Main input row */}\n                <div className=\"flex items-center gap-3 mb-3\">\n                  <Input\n                    ref={messageInputRef}\n                    placeholder={isSnapMode ? \"Send a disappearing message...\" : \"Type a message...\"}\n                    value={newMessage}\n                    onChange={(e) => setNewMessage(e.target.value)}\n                    onKeyPress={(e) => e.key === 'Enter' && handleSendMessage()}\n                    disabled={sending}\n                    className={`flex-1 bg-white/5 border-white/20 text-white placeholder:text-white/50 h-12 text-base ${\n                      isSnapMode ? 'border-yellow-400 border-2' : ''\n                    }`}\n                  />\n                  \n                  <Button \n                    onClick={handleSendMessage}\n                    disabled={sending || !newMessage.trim()}\n                    className={`h-12 px-6 ${\n                      isSnapMode\n                        ? 'bg-yellow-400 hover:bg-yellow-500 text-black'\n                        : 'bg-gradient-to-r from-pink-500 to-purple-500 hover:from-pink-600 hover:to-purple-600 text-white'\n                    } border-0`}\n                  >\n                    <Send className=\"w-5 h-5\" />\n                  </Button>\n                </div>\n                \n                {/* Action buttons row */}\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center gap-2\">\n                    <Button \n                      size=\"sm\"\n                      variant=\"ghost\"\n                      onClick={() => fileInputRef.current?.click()}\n                      disabled={sending}\n                      className=\"text-white/70 hover:text-white hover:bg-white/10 h-9\"\n                    >\n                      <ImageIcon className=\"w-5 h-5 mr-1\" />\n                      <span className=\"text-sm\">Photo</span>\n                    </Button>\n                    \n                    <Button \n                      size=\"sm\"\n                      variant=\"ghost\"\n                      onClick={() => documentInputRef.current?.click()}\n                      disabled={sending}\n                      className=\"text-white/70 hover:text-white hover:bg-white/10 h-9\"\n                    >\n                      <Paperclip className=\"w-5 h-5 mr-1\" />\n                      <span className=\"text-sm\">File</span>\n                    </Button>\n                    \n                    <Popover open={showEmojiPicker} onOpenChange={setShowEmojiPicker}>\n                      <PopoverTrigger asChild>\n                        <Button \n                          size=\"sm\"\n                          variant=\"ghost\"\n                          className=\"text-white/70 hover:text-white hover:bg-white/10 h-9\"\n                        >\n                          <Smile className=\"w-5 h-5 mr-1\" />\n                          <span className=\"text-sm\">Emoji</span>\n                        </Button>\n                      </PopoverTrigger>\n                      <PopoverContent className=\"w-80 backdrop-blur-xl bg-white/10 border-white/20 p-0\">\n                        <ScrollArea className=\"h-80\">\n                          <div className=\"p-4\">\n                            {Object.entries(emojiCategories).map(([category, emojis]) => (\n                              <div key={category} className=\"mb-4\">\n                                <div className=\"text-white/70 text-sm mb-2\">{category}</div>\n                                <div className=\"grid grid-cols-8 gap-2\">\n                                  {emojis.map((emoji, index) => (\n                                    <button\n                                      key={index}\n                                      onClick={() => {\n                                        handleEmojiSelect(emoji);\n                                        setShowEmojiPicker(false);\n                                      }}\n                                      className=\"text-2xl hover:scale-125 transition-transform p-1 hover:bg-white/10 rounded\"\n                                    >\n                                      {emoji}\n                                    </button>\n                                  ))}\n                                </div>\n                              </div>\n                            ))}\n                          </div>\n                        </ScrollArea>\n                      </PopoverContent>\n                    </Popover>\n                    \n                    <VoiceRecorder onSendVoice={handleVoiceSend} />\n                  </div>\n\n                  <MessageInspiration onInsertMessage={(msg) => setNewMessage(msg)} />\n                </div>\n              </div>\n            </div>\n          </>\n        )}\n      </Card>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}}]
}