{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/mohammedvepari/Documents/Algoma%20University/Fall%202025/COSC%204086/move-y-splash-new/src/app/components/VideoChat.tsx"],"sourcesContent":["'use client';\n\nimport { useState, useEffect, useRef, useCallback, useMemo } from 'react';\nimport Image from 'next/image';\nimport { Avatar, AvatarFallback, AvatarImage } from './ui/avatar';\nimport { Button } from './ui/button';\nimport { Card } from './ui/card';\nimport { Input } from './ui/input';\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger\n} from './ui/dropdown-menu';\nimport { \n  Video,\n  VideoOff,\n  Mic,\n  MicOff,\n  Monitor,\n  MonitorOff,\n  Settings,\n  Users,\n  MessageSquare,\n  Phone,\n  PhoneOff,\n  Grid3x3,\n  MoreVertical,\n  X\n} from 'lucide-react';\nimport { toast } from 'sonner';\nimport { useUser } from '../utils/userContext';\nimport { projectId, publicAnonKey } from '../utils/supabase/info';\n\ninterface Participant {\n  userId: string;\n  name: string;\n  avatar: string;\n  isMuted: boolean;\n  isVideoOff: boolean;\n  isSpeaking: boolean;\n  isScreenSharing: boolean;\n  isSelf: boolean;\n  joinedAt: string;\n  lastSeenAt: string;\n}\n\ntype ChatMessage = {\n  id: string;\n  author: string;\n  text: string;\n  isSelf: boolean;\n  timestamp: string;\n};\n\ninterface VideoChatProps {\n  callType?: 'audio' | 'video';\n  onEndCall?: () => void;\n  isIncoming?: boolean;\n  callerName?: string;\n  demoMode?: boolean;\n}\n\nconst extractErrorInfo = (error: unknown): { name: string; message: string } => {\n  if (error instanceof Error) {\n    return { name: error.name, message: error.message };\n  }\n  if (typeof error === 'object' && error !== null) {\n    const potentialError = error as { name?: unknown; message?: unknown };\n    const name = typeof potentialError.name === 'string' ? potentialError.name : '';\n    const message = typeof potentialError.message === 'string' ? potentialError.message : '';\n    return { name, message };\n  }\n  return { name: '', message: '' };\n};\n\ntype CameraProfile = {\n  label: string;\n  constraints: boolean | MediaTrackConstraints;\n};\n\ntype VideoPresenceRecord = {\n  userId: string;\n  roomId: string;\n  joinedAt: string;\n  lastSeenAt: string;\n  isMuted: boolean;\n  isVideoOff: boolean;\n  isScreenSharing: boolean;\n  displayName?: string | null;\n  avatar?: string | null;\n};\n\nconst MICROPHONE_CONSTRAINTS: MediaTrackConstraints = {\n  echoCancellation: { ideal: true },\n  noiseSuppression: { ideal: true },\n  autoGainControl: { ideal: true },\n};\n\nconst CAMERA_PROFILES: CameraProfile[] = [\n  {\n    label: '4K UHD',\n    constraints: {\n      width: { ideal: 3840 },\n      height: { ideal: 2160 },\n      frameRate: { ideal: 30 },\n    },\n  },\n  {\n    label: 'Full HD',\n    constraints: {\n      width: { ideal: 1920 },\n      height: { ideal: 1080 },\n      frameRate: { ideal: 30 },\n    },\n  },\n  {\n    label: 'HD',\n    constraints: {\n      width: { ideal: 1280 },\n      height: { ideal: 720 },\n      frameRate: { ideal: 30 },\n    },\n  },\n  {\n    label: 'SD',\n    constraints: {\n      width: { ideal: 960 },\n      height: { ideal: 540 },\n      frameRate: { ideal: 24 },\n    },\n  },\n  {\n    label: 'Compatibility',\n    constraints: true,\n  },\n];\n\nconst determineVideoQualityLabel = (width?: number): string | null => {\n  if (!width) {\n    return null;\n  }\n  if (width >= 3800) return '4K UHD';\n  if (width >= 1900) return 'Full HD';\n  if (width >= 1200) return 'HD';\n  if (width >= 900) return 'SD';\n  return 'SD';\n};\n\nconst cameraConnectedToastCopy = (quality: string | null) => {\n  switch (quality) {\n    case '4K UHD':\n      return '4K UHD Camera connected! ðŸ“·âœ¨';\n    case 'Full HD':\n      return 'Full HD Camera connected! ðŸ“·';\n    case 'HD':\n      return 'HD Camera connected! ðŸ“·';\n    case 'SD':\n      return 'Camera connected in SD! ðŸ“·';\n    default:\n      return 'Camera connected! ðŸ“·';\n  }\n};\n\nconst isCameraBusyError = (error: unknown) => {\n  const { name, message } = extractErrorInfo(error);\n  const normalizedName = name.toLowerCase();\n  const normalizedMessage = message.toLowerCase();\n\n  return (\n    normalizedName === 'notreadableerror' ||\n    normalizedName === 'aborterror' ||\n    normalizedMessage.includes('already in use') ||\n    normalizedMessage.includes('busy') ||\n    normalizedMessage.includes('could not start video source')\n  );\n};\n\nconst requestCameraStream = async () => {\n  if (typeof navigator === 'undefined' || !navigator.mediaDevices?.getUserMedia) {\n    throw new Error('Media devices are not supported in this environment');\n  }\n\n  let lastError: unknown = null;\n  let sharedCameraDetected = false;\n\n  for (let index = 0; index < CAMERA_PROFILES.length; index += 1) {\n    const profile = CAMERA_PROFILES[index];\n    try {\n      const videoConstraints =\n        profile.constraints === true\n          ? profile.constraints\n          : {\n              facingMode: { ideal: 'user' as const },\n              ...profile.constraints,\n            };\n\n      const stream = await navigator.mediaDevices.getUserMedia({\n        video: videoConstraints,\n        audio: MICROPHONE_CONSTRAINTS,\n      });\n\n      return {\n        stream,\n        profileLabel: profile.label,\n        profileIndex: index,\n        sharedCameraDetected,\n      };\n    } catch (error) {\n      lastError = error;\n      const { name, message } = extractErrorInfo(error);\n      const normalizedName = name.toLowerCase();\n      const normalizedMessage = message.toLowerCase();\n\n      if (\n        normalizedName === 'notallowederror' ||\n        normalizedName === 'securityerror' ||\n        normalizedMessage.includes('permission denied')\n      ) {\n        throw error;\n      }\n\n      if (normalizedName === 'notfounderror') {\n        throw error;\n      }\n\n      if (isCameraBusyError(error)) {\n        sharedCameraDetected = true;\n        continue;\n      }\n\n      if (normalizedName === 'overconstrainederror') {\n        continue;\n      }\n\n      throw error;\n    }\n  }\n\n  if (lastError && isCameraBusyError(lastError)) {\n    const conflictError = new Error('Camera already in use by another app');\n    conflictError.name = 'CameraConflictError';\n    throw conflictError;\n  }\n\n  throw lastError ?? new Error('Unable to access camera');\n};\n\nconst avatarForId = (id: string) =>\n  `https://api.dicebear.com/7.x/avataaars/svg?seed=${encodeURIComponent(id || 'video')}`;\n\nconst isCameraConflictError = (error: unknown): boolean =>\n  error instanceof Error && error.name === 'CameraConflictError';\n\nconst CAMERA_SAFE_START_STORAGE_KEY = 'movesplash:cameraSafeStart';\nconst VIDEO_ROOM_ID = 'global-stage';\nconst VIDEO_API_BASE = `https://${projectId}.supabase.co/functions/v1/make-server-a14c7986/video/rooms`;\nconst VIDEO_AUTH_HEADERS = {\n  'Content-Type': 'application/json',\n  Authorization: `Bearer ${publicAnonKey}`,\n};\nconst VIDEO_GET_HEADERS = {\n  Authorization: `Bearer ${publicAnonKey}`,\n};\n\ntype ScreenSelection = 'auto' | 'all-monitors' | string;\n\ntype ScreenInfo = {\n  id: string;\n  label: string;\n  isPrimary: boolean;\n  size: string;\n};\n\ntype ScreenDetailEntry = {\n  id?: string;\n  label?: string;\n  isPrimary?: boolean;\n  isInternal?: boolean;\n  width?: number;\n  height?: number;\n};\n\ntype ScreenDetailsResult = {\n  screens?: ScreenDetailEntry[] | ReadonlyArray<ScreenDetailEntry>;\n  currentScreen?: ScreenDetailEntry;\n  addEventListener?: (type: 'screenschange' | 'currentscreenchange', listener: () => void) => void;\n  removeEventListener?: (type: 'screenschange' | 'currentscreenchange', listener: () => void) => void;\n};\n\ntype AdvancedDisplayConstraints = MediaTrackConstraints & {\n  logicalSurface?: boolean;\n  monitorTypeSurfaces?: Array<'monitor' | 'window' | 'browser' | 'application'>;\n  surfaceSwitching?: 'include' | 'exclude';\n  preferCurrentTab?: boolean;\n  selfBrowserSurface?: 'include' | 'exclude';\n  cursor?: 'always' | 'motion' | 'never';\n};\n\ndeclare global {\n  interface Navigator {\n    getScreenDetails?: () => Promise<ScreenDetailsResult>;\n  }\n}\n\nexport function VideoChat({ \n  callType = 'video', \n  onEndCall,\n  isIncoming = false,\n  callerName = 'The Squad ðŸ”¥',\n  demoMode: initialDemoMode = false\n}: VideoChatProps) {\n  const [{ initialDemoState, initialSafeStart, autoSafeReason }] = useState(() => {\n    if (typeof window === 'undefined') {\n      return { initialDemoState: initialDemoMode, initialSafeStart: false, autoSafeReason: null };\n    }\n\n    const host = window.location.hostname;\n    const runningLocally =\n      host === 'localhost' ||\n      host === '127.0.0.1' ||\n      host.startsWith('192.168.') ||\n      host.endsWith('.local');\n\n    let storedPreference: string | null = null;\n    try {\n      storedPreference = window.localStorage.getItem(CAMERA_SAFE_START_STORAGE_KEY);\n    } catch {\n      storedPreference = null;\n    }\n\n    const parsedPreference =\n      storedPreference === 'true' ? true : storedPreference === 'false' ? false : null;\n    const safeStart = parsedPreference ?? runningLocally;\n\n    return {\n      initialDemoState: initialDemoMode || safeStart,\n      initialSafeStart: safeStart,\n      autoSafeReason: parsedPreference === null && safeStart ? (runningLocally ? 'local' : 'unknown') : null,\n    };\n  });\n  const [cameraSafeStart, setCameraSafeStart] = useState(initialSafeStart);\n  const [isMuted, setIsMuted] = useState(false);\n  const [isVideoOff, setIsVideoOff] = useState(callType === 'audio');\n  const [isScreenSharing, setIsScreenSharing] = useState(false);\n  const [viewMode, setViewMode] = useState<'grid' | 'speaker'>('grid');\n  const [callStatus, setCallStatus] = useState<'ringing' | 'connecting' | 'connected'>(\n    isIncoming ? 'ringing' : 'connecting'\n  );\n  const [callDuration, setCallDuration] = useState(0);\n  const [mediaStream, setMediaStream] = useState<MediaStream | null>(null);\n  const mediaStreamRef = useRef<MediaStream | null>(null);\n  const localVideoRef = useRef<HTMLVideoElement>(null);\n  const demoCanvasRef = useRef<HTMLCanvasElement>(null);\n  const screenShareDemoCanvasRef = useRef<HTMLCanvasElement>(null);\n  const cameraSnapshotCanvasRef = useRef<HTMLCanvasElement>(null);\n  const [cameraError, setCameraError] = useState<string | null>(null);\n  const [demoMode, setDemoMode] = useState(initialDemoState);\n  const [screenShareDemoMode, setScreenShareDemoMode] = useState(initialDemoState);\n  const [videoQuality, setVideoQuality] = useState<string | null>(null);\n  const [screenShareQuality, setScreenShareQuality] = useState<string | null>(null);\n  const [availableScreens, setAvailableScreens] = useState<ScreenInfo[]>([]);\n  const [screenShareTarget, setScreenShareTarget] = useState<ScreenSelection>('auto');\n  const [screenShareSourceLabel, setScreenShareSourceLabel] = useState<string | null>(null);\n  const [isScreenShareStreaming, setIsScreenShareStreaming] = useState(false);\n  const [autoDetectedConflict, setAutoDetectedConflict] = useState(false);\n  const [cameraConflictActive, setCameraConflictActive] = useState(false);\n  const [cameraFallbackFrame, setCameraFallbackFrame] = useState<string | null>(null);\n  const [cameraAutoRetryEnabled, setCameraAutoRetryEnabled] = useState(true);\n  const [sharedCameraMode, setSharedCameraMode] = useState(false);\n  const cameraRetryTimeoutRef = useRef<ReturnType<typeof setTimeout> | null>(null);\n  const [cameraRetryToken, setCameraRetryToken] = useState(0);\n  const cameraManualStopRef = useRef(false);\n  const screenShareStreamRef = useRef<MediaStream | null>(null);\n  const manualScreenShareStopRef = useRef(false);\n  const screenShareVideoRef = useRef<HTMLVideoElement>(null);\n  const { currentUser, allUsers } = useUser();\n  const currentUserId = currentUser?.id ?? null;\n  const [remoteParticipants, setRemoteParticipants] = useState<VideoPresenceRecord[]>([]);\n  const roomId = VIDEO_ROOM_ID;\n  const presencePollRef = useRef<ReturnType<typeof setInterval> | null>(null);\n  const presenceHeartbeatRef = useRef<ReturnType<typeof setInterval> | null>(null);\n  const previousUserIdRef = useRef<string | null>(currentUserId);\n  const muteStateRef = useRef(isMuted);\n  const videoStateRef = useRef(isVideoOff);\n  const screenShareStateRef = useRef(isScreenShareStreaming);\n  const [autoSpeakerMode, setAutoSpeakerMode] = useState(false);\n  const [showParticipantsPanel, setShowParticipantsPanel] = useState(false);\n  const [showChatPanel, setShowChatPanel] = useState(false);\n  const [showSettingsPanel, setShowSettingsPanel] = useState(false);\n  const [chatDraft, setChatDraft] = useState('');\n  const [chatMessages, setChatMessages] = useState<ChatMessage[]>(() => {\n    const displayName =\n      (currentUser?.name && currentUser.name.trim()) ||\n      (currentUser?.username && currentUser.username.trim()) ||\n      'You';\n\n    return [\n      {\n        id: 'welcome',\n        author: 'Host',\n        text: 'Welcome to the room! Use chat to coordinate or share links.',\n        isSelf: false,\n        timestamp: new Date().toISOString(),\n      },\n      {\n        id: 'self-intro',\n        author: displayName,\n        text: 'Hey team, I just joined the call.',\n        isSelf: true,\n        timestamp: new Date().toISOString(),\n      },\n    ];\n  });\n  const chatListRef = useRef<HTMLDivElement | null>(null);\n\n  useEffect(() => {\n    muteStateRef.current = isMuted;\n  }, [isMuted]);\n\n  useEffect(() => {\n    videoStateRef.current = isVideoOff;\n  }, [isVideoOff]);\n\n  useEffect(() => {\n    screenShareStateRef.current = isScreenShareStreaming;\n  }, [isScreenShareStreaming]);\n\n  const togglePanel = (panel: 'participants' | 'chat' | 'settings') => {\n    setShowParticipantsPanel(panel === 'participants' ? (open) => !open : false);\n    setShowChatPanel(panel === 'chat' ? (open) => !open : false);\n    setShowSettingsPanel(panel === 'settings' ? (open) => !open : false);\n  };\n\n  useEffect(() => {\n    if (!showChatPanel) {\n      return;\n    }\n    if (chatListRef.current) {\n      chatListRef.current.scrollTop = chatListRef.current.scrollHeight;\n    }\n  }, [chatMessages, showChatPanel]);\n\n  useEffect(() => {\n    let mounted = true;\n    let cleanup: (() => void) | undefined;\n    let detailsRef: ScreenDetailsResult | null = null;\n\n    const fallbackToPrimary = () => {\n      if (!mounted) {\n        return;\n      }\n      if (typeof window === 'undefined') {\n        return;\n      }\n      const width = window.screen?.width ?? 0;\n      const height = window.screen?.height ?? 0;\n      setAvailableScreens([\n        {\n          id: 'primary',\n          label: 'Primary Monitor',\n          isPrimary: true,\n          size: width && height ? `${width}Ã—${height}` : 'Primary',\n        },\n      ]);\n    };\n\n    const updateScreens = (screens: ScreenDetailsResult['screens']) => {\n      if (!mounted || !screens) {\n        return;\n      }\n      const normalized = Array.from(screens).map((screen, index) => {\n        const id = screen.id ?? `monitor-${index}`;\n        const rawLabel = screen.label?.trim();\n        const label =\n          rawLabel && rawLabel.length > 0\n            ? rawLabel\n            : `Monitor ${index + 1}${screen.isPrimary ? ' (Primary)' : ''}`;\n        const width =\n          screen.width ??\n          (typeof window !== 'undefined' ? window.screen?.width ?? undefined : undefined);\n        const height =\n          screen.height ??\n          (typeof window !== 'undefined' ? window.screen?.height ?? undefined : undefined);\n\n        return {\n          id,\n          label,\n          isPrimary: Boolean(screen.isPrimary) || index === 0,\n          size: width && height ? `${width}Ã—${height}` : 'Unknown',\n        };\n      });\n\n      if (normalized.length === 0) {\n        fallbackToPrimary();\n        return;\n      }\n\n      setAvailableScreens(normalized);\n    };\n\n    const init = async () => {\n      if (typeof navigator === 'undefined') {\n        fallbackToPrimary();\n        return;\n      }\n\n      if (typeof navigator.getScreenDetails !== 'function') {\n        fallbackToPrimary();\n        return;\n      }\n\n      try {\n        detailsRef = await navigator.getScreenDetails();\n        updateScreens(detailsRef.screens);\n        const handleChange = () => updateScreens(detailsRef?.screens);\n        detailsRef?.addEventListener?.('screenschange', handleChange);\n        detailsRef?.addEventListener?.('currentscreenchange', handleChange);\n        cleanup = () => {\n          detailsRef?.removeEventListener?.('screenschange', handleChange);\n          detailsRef?.removeEventListener?.('currentscreenchange', handleChange);\n        };\n      } catch (error) {\n        console.warn('Unable to access multi-monitor details:', error);\n        fallbackToPrimary();\n      }\n    };\n\n    void init();\n\n    return () => {\n      mounted = false;\n      cleanup?.();\n    };\n  }, []);\n\n  const selectedScreen = useMemo(() => {\n    if (screenShareTarget === 'auto' || screenShareTarget === 'all-monitors') {\n      return null;\n    }\n    return availableScreens.find((screen) => screen.id === screenShareTarget) ?? null;\n  }, [availableScreens, screenShareTarget]);\n\n  const multipleScreensDetected = availableScreens.length > 1;\n\n  const monitorSelectionLabel = useMemo(() => {\n    if (screenShareTarget === 'all-monitors') {\n      return 'All Monitors';\n    }\n    if (selectedScreen) {\n      return selectedScreen.label;\n    }\n    if (multipleScreensDetected) {\n      return 'Auto-select Monitor';\n    }\n    return 'Primary Monitor';\n  }, [multipleScreensDetected, selectedScreen, screenShareTarget]);\n\n  useEffect(() => {\n    if (\n      screenShareTarget !== 'auto' &&\n      screenShareTarget !== 'all-monitors' &&\n      !availableScreens.some((screen) => screen.id === screenShareTarget)\n    ) {\n      setScreenShareTarget('auto');\n    }\n  }, [availableScreens, screenShareTarget]);\n\n  const effectiveScreenShareActive = isScreenSharing;\n  const visibleScreenShareQuality = effectiveScreenShareActive ? screenShareQuality : null;\n  const visibleScreenShareSource = effectiveScreenShareActive ? screenShareSourceLabel : null;\n\n  useEffect(() => {\n    const element = screenShareVideoRef.current;\n    const stream = screenShareStreamRef.current;\n\n    if (!element) {\n      return;\n    }\n\n    if (!isScreenShareStreaming || screenShareDemoMode || !stream) {\n      if (element.srcObject) {\n        element.srcObject = null;\n      }\n      return;\n    }\n\n    element.srcObject = stream;\n    const play = async () => {\n      try {\n        await element.play();\n      } catch (error) {\n        console.warn('Unable to start screen share preview', error);\n      }\n    };\n    void play();\n\n    return () => {\n      if (element.srcObject === stream) {\n        element.srcObject = null;\n      }\n    };\n  }, [isScreenShareStreaming, screenShareDemoMode]);\n\n  const loadPresence = useCallback(async () => {\n    try {\n      const response = await fetch(\n        `${VIDEO_API_BASE}/${encodeURIComponent(roomId)}/presence`,\n        { headers: VIDEO_GET_HEADERS },\n      );\n\n      if (!response.ok) {\n        throw new Error(`status ${response.status}`);\n      }\n\n      const payload = (await response.json().catch(() => null)) as {\n        participants?: VideoPresenceRecord[];\n      } | null;\n\n      const records = Array.isArray(payload?.participants) ? payload.participants : [];\n\n      setRemoteParticipants(\n        records.map((record) => ({\n          ...record,\n          displayName: record.displayName ?? null,\n          avatar: record.avatar ?? null,\n        })),\n      );\n    } catch (error) {\n      console.warn('Failed to refresh video presence', error);\n    }\n  }, [roomId]);\n\n  const announcePresence = useCallback(\n    async (\n      overrides: Partial<{\n        isMuted: boolean;\n        isVideoOff: boolean;\n        isScreenSharing: boolean;\n      }> = {},\n    ) => {\n      if (!currentUserId) {\n        return;\n      }\n\n      const nextMuted = overrides.isMuted ?? muteStateRef.current;\n      const nextVideoOff = overrides.isVideoOff ?? videoStateRef.current;\n      const nextScreenShare = overrides.isScreenSharing ?? screenShareStateRef.current;\n\n      const resolvedName =\n        (currentUser?.name && currentUser.name.trim()) ||\n        (currentUser?.username && currentUser.username.trim()) ||\n        `Guest ${currentUserId.slice(0, 6)}`;\n\n      const resolvedAvatar =\n        currentUser?.avatar ||\n        (currentUser?.ablyClientId ? avatarForId(currentUser.ablyClientId) : avatarForId(currentUserId));\n\n      try {\n        const response = await fetch(\n          `${VIDEO_API_BASE}/${encodeURIComponent(roomId)}/presence`,\n          {\n            method: 'POST',\n            headers: VIDEO_AUTH_HEADERS,\n            body: JSON.stringify({\n              userId: currentUserId,\n              displayName: resolvedName,\n              avatar: resolvedAvatar,\n              isMuted: nextMuted,\n              isVideoOff: nextVideoOff,\n              isScreenSharing: nextScreenShare,\n            }),\n          },\n        );\n\n        if (!response.ok) {\n          throw new Error(`status ${response.status}`);\n        }\n\n        const payload = (await response.json().catch(() => null)) as {\n          participant?: VideoPresenceRecord;\n        } | null;\n\n        if (payload?.participant) {\n          const participant = payload.participant;\n          setRemoteParticipants((prev) => {\n            const map = new Map(prev.map((participant) => [participant.userId, participant]));\n            map.set(participant.userId, {\n              ...participant,\n              displayName: participant.displayName ?? null,\n              avatar: participant.avatar ?? null,\n            });\n            return Array.from(map.values());\n          });\n        }\n      } catch (error) {\n        console.warn('Failed to update video presence', error);\n      }\n    },\n    [\n      currentUser?.ablyClientId,\n      currentUser?.avatar,\n      currentUser?.name,\n      currentUser?.username,\n      currentUserId,\n      roomId,\n    ],\n  );\n\n  const removePresence = useCallback(\n    async (userId: string | null) => {\n      if (!userId) {\n        return;\n      }\n\n      try {\n        await fetch(\n          `${VIDEO_API_BASE}/${encodeURIComponent(roomId)}/presence/${encodeURIComponent(userId)}`,\n          {\n            method: 'DELETE',\n            headers: VIDEO_GET_HEADERS,\n          },\n        );\n      } catch (error) {\n        console.warn('Failed to remove video presence', error);\n      }\n    },\n    [roomId],\n  );\n\n  useEffect(() => {\n    if (!currentUserId) {\n      setRemoteParticipants([]);\n      return;\n    }\n\n    void announcePresence({\n      isMuted,\n      isVideoOff,\n      isScreenSharing: isScreenShareStreaming,\n    });\n  }, [announcePresence, currentUserId, isMuted, isVideoOff, isScreenShareStreaming]);\n\n  useEffect(() => {\n    void loadPresence();\n\n    if (presencePollRef.current) {\n      clearInterval(presencePollRef.current);\n    }\n    presencePollRef.current = setInterval(() => {\n      void loadPresence();\n    }, 7000);\n\n    return () => {\n      if (presencePollRef.current) {\n        clearInterval(presencePollRef.current);\n        presencePollRef.current = null;\n      }\n    };\n  }, [loadPresence]);\n\n  useEffect(() => {\n    if (!currentUserId) {\n      if (presenceHeartbeatRef.current) {\n        clearInterval(presenceHeartbeatRef.current);\n        presenceHeartbeatRef.current = null;\n      }\n      return;\n    }\n\n    void announcePresence();\n\n    if (presenceHeartbeatRef.current) {\n      clearInterval(presenceHeartbeatRef.current);\n    }\n    presenceHeartbeatRef.current = setInterval(() => {\n      void announcePresence();\n    }, 20000);\n\n    return () => {\n      if (presenceHeartbeatRef.current) {\n        clearInterval(presenceHeartbeatRef.current);\n        presenceHeartbeatRef.current = null;\n      }\n    };\n  }, [announcePresence, currentUserId]);\n\n  useEffect(() => {\n    const previousUserId = previousUserIdRef.current;\n    if (previousUserId && previousUserId !== currentUserId) {\n      void removePresence(previousUserId);\n    }\n    previousUserIdRef.current = currentUserId;\n\n    return () => {\n      void removePresence(previousUserIdRef.current ?? currentUserId);\n    };\n  }, [currentUserId, removePresence]);\n\n  const activateCameraConflictFallback = useCallback(() => {\n    setMediaStream(null);\n    setSharedCameraMode(false);\n    setCameraConflictActive(true);\n    setAutoDetectedConflict(true);\n    setCameraAutoRetryEnabled(false);\n    cameraManualStopRef.current = false;\n\n    if (cameraRetryTimeoutRef.current) {\n      clearTimeout(cameraRetryTimeoutRef.current);\n      cameraRetryTimeoutRef.current = null;\n    }\n\n    if (mediaStreamRef.current) {\n      mediaStreamRef.current.getTracks().forEach(track => track.stop());\n      mediaStreamRef.current = null;\n    }\n\n    if (!demoMode) {\n      setDemoMode(true);\n      toast.success('ðŸ“¸ Camera is already in use (Google Meet / Zoom). Showing demo preview so their call stays live.');\n    } else {\n      toast.info('ðŸ“¸ Camera still controlled by another app. Keeping the demo preview active.');\n    }\n  }, [demoMode]);\n\n  const scheduleCameraRetry = useCallback(() => {\n    if (!cameraAutoRetryEnabled) {\n      return;\n    }\n\n    if (cameraRetryTimeoutRef.current) {\n      return;\n    }\n\n    cameraRetryTimeoutRef.current = setTimeout(() => {\n      setCameraRetryToken(token => token + 1);\n      cameraRetryTimeoutRef.current = null;\n    }, 5000);\n  }, [cameraAutoRetryEnabled]);\n\n  useEffect(() => {\n    return () => {\n      if (cameraRetryTimeoutRef.current) {\n        clearTimeout(cameraRetryTimeoutRef.current);\n        cameraRetryTimeoutRef.current = null;\n      }\n    };\n  }, []);\n  useEffect(() => {\n    if (!autoSafeReason) {\n      return;\n    }\n    toast.info('Camera demo mode auto-enabled for presentations (safe start).', {\n      duration: 5000,\n    });\n  }, [autoSafeReason]);\n\n  useEffect(() => {\n    if (typeof window === 'undefined') {\n      return;\n    }\n    try {\n      window.localStorage.setItem(\n        CAMERA_SAFE_START_STORAGE_KEY,\n        cameraSafeStart ? 'true' : 'false',\n      );\n    } catch (error) {\n      console.warn('Unable to persist camera safe start preference', error);\n    }\n  }, [cameraSafeStart]);\n\n  const participants = useMemo<Participant[]>(() => {\n    const nowIso = new Date().toISOString();\n    const resolvedCurrentId = currentUser?.id ?? currentUser?.ablyClientId ?? currentUserId ?? 'guest';\n    const localPresence =\n      remoteParticipants.find((presence) => presence.userId === resolvedCurrentId) ?? null;\n\n    const displayName =\n      (currentUser?.name && currentUser.name.trim()) ||\n      (currentUser?.username && currentUser.username.trim()) ||\n      'You';\n\n    const avatarSource =\n      currentUser?.avatar ||\n      (currentUser?.ablyClientId ? avatarForId(currentUser.ablyClientId) : avatarForId(resolvedCurrentId));\n\n    const joinedAt = localPresence?.joinedAt ?? nowIso;\n    const lastSeenAt = localPresence?.lastSeenAt ?? nowIso;\n\n    const selfParticipant: Participant = {\n      userId: resolvedCurrentId,\n      name: displayName,\n      avatar: avatarSource,\n      isMuted,\n      isVideoOff,\n      isSpeaking: !isMuted && !isVideoOff && !demoMode,\n      isScreenSharing: effectiveScreenShareActive,\n      isSelf: true,\n      joinedAt,\n      lastSeenAt,\n    };\n\n    const others = remoteParticipants\n      .filter((presence) => presence.userId !== resolvedCurrentId)\n      .map((presence) => {\n        const referencedUser = allUsers.get(presence.userId) ?? null;\n\n        const resolvedName =\n          (presence.displayName && presence.displayName.trim()) ||\n          referencedUser?.name ||\n          referencedUser?.username ||\n          `Friend ${presence.userId.slice(0, 6)}`;\n\n        const resolvedAvatar =\n          presence.avatar ||\n          referencedUser?.avatar ||\n          avatarForId(referencedUser?.ablyClientId ?? presence.userId);\n\n        return {\n          userId: presence.userId,\n          name: resolvedName,\n          avatar: resolvedAvatar,\n          isMuted: presence.isMuted,\n          isVideoOff: presence.isVideoOff,\n          isSpeaking: !presence.isMuted && !presence.isVideoOff,\n          isScreenSharing: presence.isScreenSharing,\n          isSelf: false,\n          joinedAt: presence.joinedAt,\n          lastSeenAt: presence.lastSeenAt,\n        } satisfies Participant;\n      });\n\n    return [selfParticipant, ...others].sort(\n      (a, b) => new Date(a.joinedAt).getTime() - new Date(b.joinedAt).getTime(),\n    );\n  }, [\n    allUsers,\n    currentUser?.ablyClientId,\n    currentUser?.avatar,\n    currentUser?.id,\n    currentUser?.name,\n    currentUser?.username,\n    currentUserId,\n    demoMode,\n    isMuted,\n    effectiveScreenShareActive,\n    isVideoOff,\n    remoteParticipants,\n  ]);\n\n  const activeScreenSharerId = useMemo(() => {\n    if (effectiveScreenShareActive && currentUserId) {\n      return currentUserId;\n    }\n    const remoteSharer = remoteParticipants.find((presence) => presence.isScreenSharing);\n    return remoteSharer?.userId ?? null;\n  }, [currentUserId, effectiveScreenShareActive, remoteParticipants]);\n\n  useEffect(() => {\n    if (activeScreenSharerId) {\n      if (viewMode !== 'speaker') {\n        setAutoSpeakerMode(true);\n        setViewMode('speaker');\n      }\n    } else {\n      if (autoSpeakerMode && viewMode !== 'grid') {\n        setViewMode('grid');\n      }\n      if (autoSpeakerMode) {\n        setAutoSpeakerMode(false);\n      }\n    }\n  }, [activeScreenSharerId, autoSpeakerMode, viewMode]);\n\n  const screenShareParticipant = useMemo(\n    () =>\n      activeScreenSharerId\n        ? participants.find((participant) => participant.userId === activeScreenSharerId) ?? null\n        : null,\n    [participants, activeScreenSharerId],\n  );\n\n  const gridParticipants = useMemo(() => {\n    if (!screenShareParticipant) {\n      return participants;\n    }\n    return participants.filter((participant) => {\n      if (participant.userId !== screenShareParticipant.userId) {\n        return true;\n      }\n      return screenShareParticipant.isSelf;\n    });\n  }, [participants, screenShareParticipant]);\n  const participantCount = participants.length;\n  const isSoloParticipant = gridParticipants.length === 1 && gridParticipants[0]?.isSelf;\n\n  // Demo mode canvas animation\n  useEffect(() => {\n    if (!demoMode || !demoCanvasRef.current) return;\n\n    const canvas = demoCanvasRef.current;\n    const ctx = canvas.getContext('2d');\n    if (!ctx) return;\n\n    let animationId: number;\n    let hue = 0;\n\n    const animate = () => {\n      // Create gradient background\n      const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);\n      gradient.addColorStop(0, `hsl(${hue}, 70%, 50%)`);\n      gradient.addColorStop(0.5, `hsl(${(hue + 60) % 360}, 70%, 60%)`);\n      gradient.addColorStop(1, `hsl(${(hue + 120) % 360}, 70%, 50%)`);\n      \n      ctx.fillStyle = gradient;\n      ctx.fillRect(0, 0, canvas.width, canvas.height);\n\n      // Add some animated circles\n      const time = Date.now() / 1000;\n      for (let i = 0; i < 5; i++) {\n        const x = canvas.width / 2 + Math.sin(time + i) * 100;\n        const y = canvas.height / 2 + Math.cos(time + i * 1.5) * 80;\n        const radius = 20 + Math.sin(time * 2 + i) * 10;\n        \n        ctx.beginPath();\n        ctx.arc(x, y, radius, 0, Math.PI * 2);\n        ctx.fillStyle = `rgba(255, 255, 255, ${0.1 + Math.sin(time + i) * 0.1})`;\n        ctx.fill();\n      }\n\n      // Add \"DEMO MODE\" text\n      ctx.font = 'bold 24px system-ui';\n      ctx.textAlign = 'center';\n      ctx.textBaseline = 'middle';\n      ctx.fillStyle = 'rgba(255, 255, 255, 0.9)';\n      ctx.fillText('ðŸŽ¥ DEMO MODE', canvas.width / 2, canvas.height / 2);\n      \n      ctx.font = '14px system-ui';\n      ctx.fillStyle = 'rgba(255, 255, 255, 0.7)';\n      ctx.fillText('Simulated Camera Feed', canvas.width / 2, canvas.height / 2 + 35);\n\n      hue = (hue + 0.5) % 360;\n      animationId = requestAnimationFrame(animate);\n    };\n\n    animate();\n\n    return () => {\n      cancelAnimationFrame(animationId);\n    };\n  }, [demoMode]);\n\n  // Demo screen share animation\n  useEffect(() => {\n    if (!screenShareDemoMode || !isScreenSharing) return;\n\n    const canvas = screenShareDemoCanvasRef.current;\n    if (!canvas) return;\n\n    const ctx = canvas.getContext('2d');\n    if (!ctx) return;\n\n    canvas.width = 1920;\n    canvas.height = 1080;\n\n    let hue = 120; // Start with green\n    let animationId: number;\n\n    const animate = () => {\n      // Create animated gradient background\n      const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);\n      gradient.addColorStop(0, `hsl(${hue}, 60%, 40%)`);\n      gradient.addColorStop(0.5, `hsl(${(hue + 40) % 360}, 60%, 50%)`);\n      gradient.addColorStop(1, `hsl(${(hue + 80) % 360}, 60%, 40%)`);\n      \n      ctx.fillStyle = gradient;\n      ctx.fillRect(0, 0, canvas.width, canvas.height);\n\n      // Add grid pattern\n      ctx.strokeStyle = 'rgba(255, 255, 255, 0.1)';\n      ctx.lineWidth = 2;\n      const gridSize = 100;\n      for (let x = 0; x < canvas.width; x += gridSize) {\n        ctx.beginPath();\n        ctx.moveTo(x, 0);\n        ctx.lineTo(x, canvas.height);\n        ctx.stroke();\n      }\n      for (let y = 0; y < canvas.height; y += gridSize) {\n        ctx.beginPath();\n        ctx.moveTo(0, y);\n        ctx.lineTo(canvas.width, y);\n        ctx.stroke();\n      }\n\n      // Add animated squares\n      const time = Date.now() / 1000;\n      for (let i = 0; i < 8; i++) {\n        const x = (canvas.width / 4) + Math.sin(time * 0.5 + i) * 200;\n        const y = (canvas.height / 4) + Math.cos(time * 0.3 + i * 1.5) * 150;\n        const size = 40 + Math.sin(time * 2 + i) * 20;\n        \n        ctx.save();\n        ctx.translate(x, y);\n        ctx.rotate(time + i);\n        ctx.fillStyle = `rgba(255, 255, 255, ${0.1 + Math.sin(time + i) * 0.05})`;\n        ctx.fillRect(-size/2, -size/2, size, size);\n        ctx.restore();\n      }\n\n      // Add \"DEMO SCREEN SHARE\" text\n      ctx.font = 'bold 48px system-ui';\n      ctx.textAlign = 'center';\n      ctx.textBaseline = 'middle';\n      ctx.fillStyle = 'rgba(255, 255, 255, 0.95)';\n      ctx.fillText('ðŸ–¥ï¸ DEMO SCREEN SHARE', canvas.width / 2, canvas.height / 2 - 30);\n      \n      ctx.font = '24px system-ui';\n      ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';\n      ctx.fillText('Simulated Screen - Safe for Presentations', canvas.width / 2, canvas.height / 2 + 30);\n      \n      ctx.font = '18px system-ui';\n      ctx.fillStyle = 'rgba(255, 255, 255, 0.6)';\n      ctx.fillText('No conflicts with Zoom, Google Meet, Teams, or FaceTime', canvas.width / 2, canvas.height / 2 + 70);\n\n      hue = (hue + 0.3) % 360;\n      animationId = requestAnimationFrame(animate);\n    };\n\n    animate();\n\n    return () => {\n      cancelAnimationFrame(animationId);\n    };\n  }, [screenShareDemoMode, isScreenSharing]);\n\n  // Initialize webcam and microphone\n  useEffect(() => {\n    let mounted = true;\n    \n    const initMediaDevices = async () => {\n      if (demoMode) {\n        console.log('Demo mode enabled - skipping camera access');\n        setSharedCameraMode(false);\n        return;\n      }\n\n      if (callStatus === 'connected' && !isVideoOff) {\n        try {\n          const { stream, sharedCameraDetected } = await requestCameraStream();\n\n          if (!mounted) {\n            stream.getTracks().forEach(track => track.stop());\n            return;\n          }\n\n          const [videoTrack] = stream.getVideoTracks();\n          if (!videoTrack) {\n            stream.getTracks().forEach(track => track.stop());\n            throw new Error('Camera stream did not include a video track');\n          }\n\n          const settings = videoTrack.getSettings();\n          const resolvedQuality = determineVideoQualityLabel(settings.width);\n          console.log(`Camera resolution: ${settings.width}x${settings.height} @ ${settings.frameRate}fps`);\n\n          cameraManualStopRef.current = false;\n          if (cameraRetryTimeoutRef.current) {\n            clearTimeout(cameraRetryTimeoutRef.current);\n            cameraRetryTimeoutRef.current = null;\n          }\n\n          setCameraConflictActive(false);\n          setAutoDetectedConflict(false);\n          setCameraAutoRetryEnabled(true);\n          setSharedCameraMode(sharedCameraDetected);\n          setVideoQuality(resolvedQuality);\n          setMediaStream(stream);\n\n          toast.success(cameraConnectedToastCopy(resolvedQuality));\n          if (sharedCameraDetected) {\n            toast.info('Compatibility camera mode enabled so Google Meet, Zoom, or Teams keep your video connected.');\n          }\n\n          if (localVideoRef.current) {\n            localVideoRef.current.srcObject = stream;\n            localVideoRef.current.play().catch(err => {\n              console.error('Error playing video:', err);\n            });\n          }\n\n          videoTrack.onended = () => {\n            if (cameraManualStopRef.current) {\n              cameraManualStopRef.current = false;\n              return;\n            }\n            console.log('Camera track ended unexpectedly â€“ likely taken by another app.');\n            activateCameraConflictFallback();\n          };\n        } catch (error) {\n          if (isCameraConflictError(error)) {\n            activateCameraConflictFallback();\n            return;\n          }\n          console.error('Error accessing media devices:', error);\n          setCameraError('Unable to access camera/microphone');\n          toast.error('Unable to access camera/microphone. Please check permissions.');\n        }\n      } else if (isVideoOff && mediaStreamRef.current) {\n        setSharedCameraMode(false);\n        cameraManualStopRef.current = true;\n        mediaStreamRef.current.getVideoTracks().forEach(track => track.stop());\n      }\n    };\n\n    initMediaDevices();\n\n    return () => {\n      mounted = false;\n      if (mediaStreamRef.current) {\n        cameraManualStopRef.current = true;\n        mediaStreamRef.current.getTracks().forEach(track => track.stop());\n        setMediaStream(null);\n        setSharedCameraMode(false);\n      }\n      if (screenShareStreamRef.current) {\n        screenShareStreamRef.current.getTracks().forEach(track => track.stop());\n        screenShareStreamRef.current = null;\n        setIsScreenShareStreaming(false);\n        setIsScreenSharing(false);\n        setScreenShareQuality(null);\n        setScreenShareSourceLabel(null);\n      }\n    };\n  }, [callStatus, isVideoOff, demoMode, activateCameraConflictFallback, cameraRetryToken]);\n\n  useEffect(() => {\n    mediaStreamRef.current = mediaStream;\n    if (!mediaStream) {\n      setSharedCameraMode(false);\n    }\n  }, [mediaStream]);\n\n  useEffect(() => {\n    if (cameraConflictActive) {\n      scheduleCameraRetry();\n    }\n  }, [cameraConflictActive, scheduleCameraRetry]);\n\n  useEffect(() => {\n    if (!mediaStream || isVideoOff || demoMode) {\n      return;\n    }\n\n    const video = localVideoRef.current;\n    const canvas = cameraSnapshotCanvasRef.current;\n    if (!video || !canvas) {\n      return;\n    }\n\n    const captureFrame = () => {\n      if (!video || !canvas) {\n        return;\n      }\n\n      if (video.readyState < 2) {\n        return;\n      }\n\n      const ctx = canvas.getContext('2d');\n      if (!ctx) {\n        return;\n      }\n\n      const { videoWidth, videoHeight } = video;\n      if (!videoWidth || !videoHeight) {\n        return;\n      }\n\n      canvas.width = videoWidth;\n      canvas.height = videoHeight;\n      ctx.drawImage(video, 0, 0, videoWidth, videoHeight);\n      const frame = canvas.toDataURL('image/jpeg', 0.7);\n      setCameraFallbackFrame(frame);\n    };\n\n    const interval = setInterval(captureFrame, 2000);\n    captureFrame();\n\n    return () => {\n      clearInterval(interval);\n    };\n  }, [mediaStream, isVideoOff, demoMode]);\n\n  // Sync video element with mediaStream\n  useEffect(() => {\n    if (localVideoRef.current && mediaStream) {\n      localVideoRef.current.srcObject = mediaStream;\n      localVideoRef.current.play().catch(err => {\n        console.error('Error playing video:', err);\n      });\n    }\n  }, [mediaStream]);\n\n  // Update audio track when mute state changes\n  useEffect(() => {\n    if (mediaStream) {\n      mediaStream.getAudioTracks().forEach(track => {\n        track.enabled = !isMuted;\n      });\n    }\n  }, [isMuted, mediaStream]);\n\n  // Update video track when video state changes\n  useEffect(() => {\n    if (mediaStream) {\n      mediaStream.getVideoTracks().forEach(track => {\n        track.enabled = !isVideoOff;\n      });\n    }\n  }, [isVideoOff, mediaStream]);\n\n  // Simulate call connection\n  useEffect(() => {\n    if (callStatus === 'connecting') {\n      const timer = setTimeout(() => {\n        setCallStatus('connected');\n        toast.success('Call connected! ðŸ“ž');\n      }, 2000);\n      return () => clearTimeout(timer);\n    }\n  }, [callStatus]);\n\n  // Call duration timer\n  useEffect(() => {\n    if (callStatus === 'connected') {\n      const interval = setInterval(() => {\n        setCallDuration(prev => prev + 1);\n      }, 1000);\n      return () => clearInterval(interval);\n    }\n  }, [callStatus]);\n\n  const formatDuration = (seconds: number) => {\n    const mins = Math.floor(seconds / 60);\n    const secs = seconds % 60;\n    return `${mins}:${secs.toString().padStart(2, '0')}`;\n  };\n\n  const handleEndCall = () => {\n    // Stop all media tracks\n    if (mediaStream) {\n      cameraManualStopRef.current = true;\n      mediaStream.getTracks().forEach(track => track.stop());\n      setSharedCameraMode(false);\n    }\n    if (screenShareStreamRef.current) {\n      manualScreenShareStopRef.current = true;\n      screenShareStreamRef.current.getTracks().forEach(track => track.stop());\n      screenShareStreamRef.current = null;\n    }\n    setIsScreenShareStreaming(false);\n    setIsScreenSharing(false);\n    setScreenShareQuality(null);\n    setScreenShareSourceLabel(null);\n    toast.success('Call ended');\n    if (onEndCall) {\n      onEndCall();\n    }\n  };\n\n  const handleAcceptCall = () => {\n    setCallStatus('connecting');\n  };\n\n  const handleDeclineCall = () => {\n    toast.success('Call declined');\n    if (onEndCall) {\n      onEndCall();\n    }\n  };\n\n  const enableDemoMode = useCallback(\n    (silent = false) => {\n      if (demoMode) {\n        if (!silent) {\n          toast.info('Camera Demo Mode is already enabled.');\n        }\n        return;\n      }\n\n      if (mediaStream) {\n        cameraManualStopRef.current = true;\n        mediaStream.getTracks().forEach(track => track.stop());\n        setMediaStream(null);\n      }\n      setSharedCameraMode(false);\n      setCameraConflictActive(false);\n      if (cameraRetryTimeoutRef.current) {\n        clearTimeout(cameraRetryTimeoutRef.current);\n        cameraRetryTimeoutRef.current = null;\n      }\n      setCameraAutoRetryEnabled(false);\n      setDemoMode(true);\n      if (!silent) {\n        toast.success('Camera Demo Mode enabled - safe for presentations! ðŸŽ¬');\n      }\n    },\n    [demoMode, mediaStream],\n  );\n\n  const handleResumeCamera = useCallback((silent = false) => {\n    if (cameraRetryTimeoutRef.current) {\n      clearTimeout(cameraRetryTimeoutRef.current);\n      cameraRetryTimeoutRef.current = null;\n    }\n    setCameraAutoRetryEnabled(true);\n    setCameraConflictActive(false);\n    setAutoDetectedConflict(false);\n    setCameraError(null);\n    setDemoMode(false);\n    setSharedCameraMode(false);\n    setCameraRetryToken(token => token + 1);\n    if (!silent) {\n      toast.success('Attempting to reconnect your camera... ðŸ“·');\n    }\n  }, []);\n\n  useEffect(() => {\n    if (callStatus === 'connected' && demoMode) {\n      handleResumeCamera(true);\n    }\n  }, [callStatus, demoMode, handleResumeCamera]);\n\n  const disableDemoMode = useCallback(\n    (silent = false) => {\n      if (!demoMode) {\n        if (!silent) {\n          toast.info('Camera Demo Mode is already off.');\n        }\n        return;\n      }\n\n      setDemoMode(false);\n      handleResumeCamera(true);\n      if (!silent) {\n        toast.success('Camera Demo Mode disabled - will use real camera ðŸ“·');\n      }\n    },\n    [demoMode, handleResumeCamera],\n  );\n\n  const handleToggleMute = () => {\n    setIsMuted(!isMuted);\n    toast.success(isMuted ? 'Microphone on' : 'Microphone muted');\n  };\n\n  const handleToggleVideo = () => {\n    setIsVideoOff(!isVideoOff);\n    toast.success(isVideoOff ? 'Camera on' : 'Camera off');\n  };\n\n  const handleSelectScreenShareTarget = useCallback(\n    (target: ScreenSelection) => {\n      setScreenShareTarget(target);\n      if (target === 'all-monitors') {\n        toast.info('Next screen share will prompt you to share every monitor on your workspace.');\n      } else {\n        const chosen = availableScreens.find((screen) => screen.id === target);\n        if (chosen) {\n          toast.info(`Next screen share will request \"${chosen.label}\" in the browser prompt.`);\n        }\n      }\n      if (isScreenSharing && !screenShareDemoMode) {\n        toast.info('Stop screen share and start again to switch monitors.');\n      }\n    },\n    [availableScreens, isScreenSharing, screenShareDemoMode],\n  );\n\n  const handleToggleScreenShare = async () => {\n    // Use demo mode for screen sharing if enabled\n    if (screenShareDemoMode) {\n      if (isScreenSharing) {\n        setIsScreenShareStreaming(false);\n        setIsScreenSharing(false);\n        setScreenShareQuality(null);\n        setScreenShareSourceLabel(null);\n      } else {\n        setIsScreenShareStreaming(false);\n        setIsScreenSharing(true);\n        setScreenShareQuality('Demo');\n        setScreenShareSourceLabel('Demo Display');\n      }\n      if (!isScreenSharing) {\n        toast.success('ðŸŽ¬ Demo screen sharing started - safe for presentations!');\n      } else {\n        toast.success('Demo screen share stopped');\n      }\n      return;\n    }\n\n    if (!isScreenSharing) {\n      try {\n        const shareTarget = screenShareTarget;\n        if (shareTarget === 'all-monitors') {\n          toast.info('Select the \"Entire screen\" option to capture every monitor.');\n        } else if (selectedScreen) {\n          toast.info(`When prompted, choose \"${selectedScreen.label}\" to share that monitor.`);\n        } else if (multipleScreensDetected) {\n          toast.info('Pick the monitor you want to share in the browser prompt.');\n        }\n\n        console.log('Requesting screen share with multi-monitor support enabled...');\n\n        const videoConstraints: AdvancedDisplayConstraints = {\n          displaySurface: 'monitor',\n          width: { ideal: 7680 },\n          height: { ideal: 4320 },\n          frameRate: { ideal: 30 },\n          cursor: 'always',\n          preferCurrentTab: false,\n          surfaceSwitching: 'include',\n          selfBrowserSurface: 'exclude',\n        };\n\n        if (shareTarget === 'all-monitors') {\n          videoConstraints.logicalSurface = true;\n          videoConstraints.monitorTypeSurfaces = ['monitor'];\n        } else if (selectedScreen) {\n          videoConstraints.monitorTypeSurfaces = ['monitor'];\n        } else {\n          videoConstraints.monitorTypeSurfaces = ['monitor', 'window', 'browser'];\n        }\n\n        const screenStream = await navigator.mediaDevices.getDisplayMedia({\n          video: videoConstraints,\n          audio: {\n            echoCancellation: true,\n            noiseSuppression: true,\n            autoGainControl: true,\n          },\n        });\n        \n        // Detect actual screen share resolution\n        const [videoTrack] = screenStream.getVideoTracks();\n        if (!videoTrack) {\n          throw new Error('Screen share stream did not include a video track');\n        }\n        const settings = videoTrack.getSettings();\n        console.log(`Screen share resolution: ${settings.width}x${settings.height} @ ${settings.frameRate}fps`);\n        \n        // Determine quality label\n        if (settings.width && settings.height) {\n          if (settings.width >= 7680) {\n            setScreenShareQuality('8K UHD');\n            toast.success('ðŸ–¥ï¸ 8K UHD Screen sharing started!');\n          } else if (settings.width >= 5120) {\n            setScreenShareQuality('5K UHD');\n            toast.success('ðŸ–¥ï¸ 5K UHD Screen sharing started!');\n          } else if (settings.width >= 3840) {\n            setScreenShareQuality('4K UHD');\n            toast.success('ðŸ–¥ï¸ 4K UHD Screen sharing started!');\n          } else if (settings.width >= 2560) {\n            setScreenShareQuality('QHD');\n            toast.success('ðŸ–¥ï¸ QHD Screen sharing started!');\n          } else if (settings.width >= 1920) {\n            setScreenShareQuality('Full HD');\n            toast.success('ðŸ–¥ï¸ Full HD Screen sharing started!');\n          } else {\n            setScreenShareQuality('HD');\n            toast.success('ðŸ–¥ï¸ Screen sharing started!');\n          }\n        } else {\n          toast.success('Screen sharing started');\n        }\n        setScreenShareSourceLabel(\n          videoTrack.label || selectedScreen?.label || (shareTarget === 'all-monitors' ? 'All Monitors' : null),\n        );\n        if (screenShareStreamRef.current) {\n          screenShareStreamRef.current.getTracks().forEach(track => track.stop());\n        }\n        manualScreenShareStopRef.current = false;\n        screenShareStreamRef.current = screenStream;\n        setIsScreenShareStreaming(true);\n        setIsScreenSharing(true);\n        if (screenShareVideoRef.current) {\n          screenShareVideoRef.current.srcObject = screenStream;\n          screenShareVideoRef.current.play().catch(err => console.error('Error playing screen share video:', err));\n        }\n        \n        // Stop screen sharing when user stops it from browser UI\n        videoTrack.onended = () => {\n          screenShareStreamRef.current = null;\n          if (manualScreenShareStopRef.current) {\n            manualScreenShareStopRef.current = false;\n            setIsScreenShareStreaming(false);\n            setIsScreenSharing(false);\n            setScreenShareQuality(null);\n            setScreenShareSourceLabel(null);\n            toast.success('Screen share stopped');\n            return;\n          }\n\n          console.log('Screen share ended unexpectedly - enabling demo mode fallback');\n          setAutoDetectedConflict(true);\n          setScreenShareDemoMode(true);\n          setIsScreenShareStreaming(false);\n          setIsScreenSharing(true);\n          setScreenShareQuality('Demo');\n          setScreenShareSourceLabel('Demo Display');\n          toast.success('ðŸŽ¬ Screen Share Demo Mode auto-enabled - another app took over your screen');\n        };\n      } catch (error: unknown) {\n        console.error('Error sharing screen:', error);\n        setScreenShareSourceLabel(null);\n        \n        // Check if error is due to screen already being shared (Zoom, Meet, Teams, etc.)\n        const { name, message } = extractErrorInfo(error);\n        const errorMessage = message.toLowerCase();\n        const errorName = name.toLowerCase();\n        \n        if (errorName === 'notallowederror' || \n            errorName === 'notreadableerror' ||\n            errorMessage.includes('permission denied') ||\n            errorMessage.includes('user cancelled')) {\n          \n          // Check if it&apos;s actually a conflict vs user cancellation\n          if (errorMessage.includes('already in use') || errorName === 'notreadableerror') {\n            console.log('Screen share conflict detected - another app may be sharing');\n            console.log('Auto-enabling screen share demo mode...');\n            setScreenShareDemoMode(true);\n            setAutoDetectedConflict(true);\n            toast.success('ðŸŽ¬ Screen Share Demo Mode auto-enabled - screen in use by another app!');\n            \n            // Auto-start demo screen share\n            setIsScreenShareStreaming(false);\n            setIsScreenSharing(true);\n            setScreenShareQuality('Demo');\n            setScreenShareSourceLabel('Demo Display');\n          } else {\n            toast.error('Screen sharing cancelled');\n          }\n        } else {\n          toast.error('Unable to share screen. Please grant screen sharing permissions.');\n        }\n      }\n    } else {\n    if (screenShareStreamRef.current) {\n      manualScreenShareStopRef.current = true;\n      screenShareStreamRef.current.getTracks().forEach(track => track.stop());\n      screenShareStreamRef.current = null;\n    }\n      setIsScreenShareStreaming(false);\n      setIsScreenSharing(false);\n      setScreenShareQuality(null);\n      setScreenShareSourceLabel(null);\n    }\n  };\n\n  const handleToggleDemoMode = () => {\n    if (demoMode) {\n      disableDemoMode();\n    } else {\n      enableDemoMode();\n    }\n  };\n\n  const handleToggleScreenShareDemoMode = () => {\n    const newMode = !screenShareDemoMode;\n    setScreenShareDemoMode(newMode);\n    \n    if (newMode) {\n      // Stop any active screen share\n      if (isScreenSharing) {\n        setIsScreenShareStreaming(false);\n        setIsScreenSharing(false);\n        setScreenShareQuality(null);\n        setScreenShareSourceLabel(null);\n      }\n      if (screenShareStreamRef.current) {\n        manualScreenShareStopRef.current = true;\n        screenShareStreamRef.current.getTracks().forEach(track => track.stop());\n        screenShareStreamRef.current = null;\n      }\n      toast.success('Screen Share Demo Mode enabled - safe for presentations! ðŸ–¥ï¸');\n      if (screenShareVideoRef.current) {\n        screenShareVideoRef.current.srcObject = null;\n      }\n    } else {\n      toast.success('Screen Share Demo Mode disabled - will use real screen ðŸ–¥ï¸');\n    }\n  };\n\n  const handleToggleSafeStart = () => {\n    setCameraSafeStart((prev) => {\n      const next = !prev;\n      if (next) {\n        enableDemoMode(true);\n        toast.success('Safe Start enabled - MoveSplash will stay in demo mode when you open it.');\n      } else {\n        toast.success('Safe Start disabled - MoveSplash can auto-connect your camera again.');\n      }\n      return next;\n    });\n  };\n\n  const handleSendChatMessage = () => {\n    const text = chatDraft.trim();\n    if (!text) {\n      return;\n    }\n\n    const author =\n      (currentUser?.name && currentUser.name.trim()) ||\n      (currentUser?.username && currentUser.username.trim()) ||\n      'You';\n\n    setChatMessages((prev) => [\n      ...prev,\n      {\n        id: `msg-${Date.now()}`,\n        author,\n        text,\n        isSelf: true,\n        timestamp: new Date().toISOString(),\n      },\n    ]);\n    setChatDraft('');\n  };\n\n  // Incoming call screen\n  if (callStatus === 'ringing' && isIncoming) {\n    return (\n      <div className=\"h-[calc(100vh-80px)] flex items-center justify-center\">\n        <Card className=\"w-96 backdrop-blur-xl bg-white/10 border-white/20 p-8\">\n          <div className=\"text-center space-y-6\">\n            <div className=\"relative inline-block\">\n              <Avatar className=\"w-32 h-32 border-4 border-white/20\">\n                <AvatarImage src=\"https://api.dicebear.com/7.x/avataaars/svg?seed=Squad\" />\n                <AvatarFallback>SQ</AvatarFallback>\n              </Avatar>\n              <div className=\"absolute inset-0 rounded-full border-4 border-green-400 animate-ping\"></div>\n            </div>\n            \n            <div>\n              <h2 className=\"text-white text-2xl mb-2\">{callerName}</h2>\n              <p className=\"text-white/70\">\n                {callType === 'video' ? 'Video' : 'Voice'} call incoming...\n              </p>\n            </div>\n\n            <div className=\"flex gap-4 justify-center pt-4\">\n              <Button\n                onClick={handleDeclineCall}\n                className=\"w-16 h-16 rounded-full bg-red-500 hover:bg-red-600 text-white border-0\"\n              >\n                <PhoneOff className=\"w-6 h-6\" />\n              </Button>\n              <Button\n                onClick={handleAcceptCall}\n                className=\"w-16 h-16 rounded-full bg-green-500 hover:bg-green-600 text-white border-0\"\n              >\n                <Phone className=\"w-6 h-6\" />\n              </Button>\n            </div>\n          </div>\n        </Card>\n      </div>\n    );\n  }\n\n  // Connecting screen\n  if (callStatus === 'connecting') {\n    return (\n      <div className=\"h-[calc(100vh-80px)] flex items-center justify-center\">\n        <Card className=\"w-96 backdrop-blur-xl bg-white/10 border-white/20 p-8\">\n          <div className=\"text-center space-y-6\">\n            <div className=\"relative inline-block\">\n              <Avatar className=\"w-32 h-32 border-4 border-white/20\">\n                <AvatarImage src=\"https://api.dicebear.com/7.x/avataaars/svg?seed=Squad\" />\n                <AvatarFallback>SQ</AvatarFallback>\n              </Avatar>\n              <div className=\"absolute inset-0 rounded-full border-4 border-blue-400 animate-spin\" style={{ animationDuration: '2s' }}></div>\n            </div>\n            \n            <div>\n              <h2 className=\"text-white text-2xl mb-2\">Connecting...</h2>\n              <p className=\"text-white/70\">Please wait</p>\n            </div>\n\n            <Button\n              onClick={handleEndCall}\n              className=\"w-16 h-16 rounded-full bg-red-500 hover:bg-red-600 text-white border-0\"\n            >\n              <X className=\"w-6 h-6\" />\n            </Button>\n          </div>\n        </Card>\n      </div>\n    );\n  }\n\n  // Active call screen\n  return (\n    <div className=\"h-[calc(100vh-80px)] flex flex-col max-w-7xl mx-auto gap-4\">\n      <canvas ref={cameraSnapshotCanvasRef} className=\"hidden\" />\n      {/* Auto-Detection Banner */}\n      {autoDetectedConflict && (cameraConflictActive || screenShareDemoMode) && (\n        <Card className=\"backdrop-blur-xl bg-gradient-to-r from-yellow-500/90 to-orange-500/90 border-yellow-400 px-6 py-3\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"w-10 h-10 bg-white/20 rounded-full flex items-center justify-center\">\n                <span className=\"text-2xl\">âš¡</span>\n              </div>\n              <div>\n                <h3 className=\"text-white font-medium\">Camera or Screen in use elsewhere</h3>\n                <p className=\"text-white/80 text-sm\">\n                  We switched to the simulated preview while Zoom, Meet, or Teams has your hardware. Resume the real feed once the other app releases it.\n                </p>\n              </div>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              {!cameraAutoRetryEnabled && cameraConflictActive && (\n                <Button\n                  onClick={() => handleResumeCamera()}\n                  className=\"bg-white/20 text-white hover:bg-white/30 border-0\"\n                >\n                  Resume real camera\n                </Button>\n              )}\n              <Button\n                onClick={() => setAutoDetectedConflict(false)}\n                variant=\"ghost\"\n                className=\"text-white hover:bg-white/20\"\n              >\n                Dismiss\n              </Button>\n            </div>\n          </div>\n        </Card>\n      )}\n\n      {/* Camera Demo Mode Banner */}\n      {demoMode && !autoDetectedConflict && (\n        <Card className=\"backdrop-blur-xl bg-gradient-to-r from-purple-500/90 to-pink-500/90 border-purple-400 px-6 py-3\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"w-10 h-10 bg-white/20 rounded-full flex items-center justify-center\">\n                <span className=\"text-2xl\">ðŸŽ¬</span>\n              </div>\n              <div>\n                <h3 className=\"text-white font-medium\">Camera Demo Mode Active</h3>\n                <p className=\"text-white/80 text-sm\">\n                  Simulated camera - safe for presentations! Your real camera is not in use.\n                </p>\n              </div>\n            </div>\n            <Button\n              onClick={handleToggleDemoMode}\n              variant=\"ghost\"\n              className=\"text-white hover:bg-white/20\"\n            >\n              Disable Camera Demo\n            </Button>\n          </div>\n        </Card>\n      )}\n\n      {/* Screen Share Demo Mode Banner */}\n      {screenShareDemoMode && !autoDetectedConflict && (\n        <Card className=\"backdrop-blur-xl bg-gradient-to-r from-green-500/90 to-teal-500/90 border-green-400 px-6 py-3\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"w-10 h-10 bg-white/20 rounded-full flex items-center justify-center\">\n                <span className=\"text-2xl\">ðŸ–¥ï¸</span>\n              </div>\n              <div>\n                <h3 className=\"text-white font-medium\">Screen Share Demo Mode Active</h3>\n                <p className=\"text-white/80 text-sm\">\n                  Simulated screen share - safe for presentations! Won&apos;t conflict with Zoom/Meet/Teams.\n                </p>\n              </div>\n            </div>\n            <Button\n              onClick={handleToggleScreenShareDemoMode}\n              variant=\"ghost\"\n              className=\"text-white hover:bg-white/20\"\n            >\n              Disable Screen Demo\n            </Button>\n          </div>\n        </Card>\n      )}\n\n      {/* Call Info Bar */}\n      <Card className=\"backdrop-blur-xl bg-white/10 border-white/20 px-6 py-3\">\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center gap-3\">\n            <div className=\"w-2 h-2 bg-green-400 rounded-full animate-pulse\"></div>\n            <span className=\"text-white\">\n              {callerName} â€¢ {formatDuration(callDuration)}\n            </span>\n            {cameraConflictActive ? (\n              <span className=\"text-xs text-yellow-200\">\n                ðŸ“¸ Cached camera preview\n              </span>\n            ) : demoMode ? (\n              <span className=\"text-xs text-purple-400\">\n                ðŸŽ¬ Demo Mode\n              </span>\n            ) : mediaStream && videoQuality ? (\n              <span className=\"text-xs text-green-400\">\n                ðŸ“¹ {videoQuality}\n              </span>\n            ) : mediaStream ? (\n              <span className=\"text-xs text-green-400\">\n                ðŸ“¹ Camera Active\n              </span>\n            ) : null}\n            {sharedCameraMode && !cameraConflictActive && !demoMode && (\n              <span className=\"text-xs text-yellow-200 flex items-center gap-1\">\n                ðŸ¤ Shared cam mode\n              </span>\n            )}\n            {visibleScreenShareQuality && (\n              <span className={`text-xs px-2 py-0.5 rounded ${\n                visibleScreenShareQuality === '8K UHD' \n                  ? 'bg-gradient-to-r from-purple-500 to-pink-500 text-white'\n                  : visibleScreenShareQuality === '5K UHD' || visibleScreenShareQuality === '4K UHD'\n                  ? 'bg-blue-500/80 text-white'\n                  : 'bg-green-500/80 text-white'\n              }`}>\n                ðŸ–¥ï¸ {visibleScreenShareQuality} Screen Share\n                {visibleScreenShareSource && (\n                  <span className=\"block text-[10px] text-white/80 mt-0.5\">\n                    {visibleScreenShareSource}\n                  </span>\n                )}\n              </span>\n            )}\n          </div>\n          <div className=\"flex items-center gap-2 text-white/70 text-sm\">\n            <Monitor className=\"w-4 h-4\" />\n            <span>{visibleScreenShareQuality ?? videoQuality ?? 'HD'} Quality</span>\n            {visibleScreenShareSource && (\n              <span className=\"text-xs text-white/60\">({visibleScreenShareSource})</span>\n            )}\n          </div>\n        </div>\n      </Card>\n\n      {/* Presenter Stage */}\n      {screenShareParticipant && (\n        <Card className=\"relative overflow-hidden backdrop-blur-xl bg-black/40 border-white/30 min-h-[320px]\">\n          {screenShareParticipant.isSelf ? (\n            screenShareDemoMode ? (\n              <div className=\"absolute inset-0 flex items-center justify-center bg-gradient-to-br from-purple-600/40 to-pink-600/40 text-center px-6\">\n                <div className=\"text-white space-y-2\">\n                  <div className=\"text-4xl\">ðŸŽ¬</div>\n                  <p className=\"font-semibold\">Screen Share Demo Mode Active</p>\n                  <p className=\"text-white/80 text-sm\">\n                    Your teammates see the simulated share while other apps use your screen.\n                  </p>\n                </div>\n              </div>\n            ) : (\n              <video\n                ref={screenShareVideoRef}\n                autoPlay\n                playsInline\n                muted\n                className=\"absolute inset-0 w-full h-full object-contain bg-black\"\n              />\n            )\n          ) : (\n            <div className=\"absolute inset-0 flex items-center justify-center bg-gradient-to-br from-slate-900/80 to-purple-900/60\">\n              <div className=\"text-center space-y-3 text-white px-6\">\n                <div className=\"text-4xl\">ðŸ–¥ï¸</div>\n                <p className=\"text-lg font-semibold\">\n                  {screenShareParticipant.name} is sharing their screen\n                </p>\n                <p className=\"text-sm text-white/70\">\n                  We switched everyone to speaker view automatically.\n                </p>\n              </div>\n            </div>\n          )}\n          <div className=\"absolute top-3 left-3 flex flex-wrap items-center gap-2\">\n            <div className=\"bg-black/60 text-white text-xs px-3 py-1 rounded-full flex items-center gap-2\">\n              <Monitor className=\"w-4 h-4\" />\n              <span>{screenShareParticipant.isSelf ? 'You' : screenShareParticipant.name}</span>\n            </div>\n            {screenShareParticipant.isSelf && screenShareQuality && (\n              <div\n                className={`text-xs px-3 py-1 rounded-full ${\n                  screenShareQuality === '8K UHD'\n                    ? 'bg-gradient-to-r from-purple-500 to-pink-500 text-white'\n                    : screenShareQuality === '5K UHD' || screenShareQuality === '4K UHD'\n                    ? 'bg-blue-500/80 text-white'\n                    : 'bg-green-500/80 text-white'\n                }`}\n              >\n                {screenShareQuality} Quality\n              </div>\n            )}\n          </div>\n        </Card>\n      )}\n\n      {/* Participant Grid */}\n      <div\n        className={`flex-1 grid gap-4 ${\n          gridParticipants.length >= 4 ? 'grid-cols-2 lg:grid-cols-3' : 'grid-cols-1 md:grid-cols-2 lg:grid-cols-3'\n        }`}\n      >\n        {gridParticipants.map((participant) => (\n          <Card\n            key={participant.userId}\n            className={`relative overflow-hidden backdrop-blur-xl bg-gradient-to-br from-purple-900/50 to-pink-900/50 border-2 transition-all min-h-[200px] ${\n              participant.isSpeaking \n                ? 'border-green-400 shadow-lg shadow-green-400/50' \n                : 'border-white/20'\n            }`}\n          >\n            {/* Video Placeholder */}\n            {participant.isSelf ? (\n              participant.isVideoOff ? (\n                <div className=\"w-full h-full flex items-center justify-center\">\n                  <Avatar className=\"w-24 h-24 border-4 border-white/20\">\n                    <AvatarImage src={participant.avatar} />\n                    <AvatarFallback>{participant.name[0] ?? 'Y'}</AvatarFallback>\n                  </Avatar>\n                </div>\n              ) : cameraConflictActive && cameraFallbackFrame ? (\n                <div className=\"relative w-full h-full\">\n                  <Image\n                    src={cameraFallbackFrame}\n                    alt=\"Camera preview\"\n                    fill\n                    unoptimized\n                    className=\"object-cover\"\n                  />\n                  <div className=\"absolute inset-0 bg-black/40 backdrop-blur-sm flex flex-col items-center justify-center text-center px-6\">\n                    <div className=\"text-white font-semibold mb-2\">Camera temporarily in use by another app</div>\n                    <p className=\"text-white/80 text-sm\">\n                      Keeping your last frame visible while Zoom/Meet/Teams is running. We&apos;ll switch back automatically.\n                    </p>\n                  </div>\n                </div>\n              ) : cameraConflictActive ? (\n                <div className=\"w-full h-full flex flex-col items-center justify-center text-center px-6 bg-gradient-to-br from-purple-600/40 to-pink-600/40 text-white\">\n                  <div className=\"text-3xl mb-2\">ðŸ“¸</div>\n                  <p className=\"font-semibold\">Camera temporarily unavailable</p>\n                  <p className=\"text-white/80 text-sm mt-1\">\n                    We&apos;re retrying while another app is using your webcam.\n                  </p>\n                </div>\n              ) : demoMode ? (\n                <>\n                  <canvas\n                    ref={demoCanvasRef}\n                    width={640}\n                    height={480}\n                    className=\"absolute inset-0 w-full h-full object-cover\"\n                  />\n                  <div className=\"absolute top-2 left-2 bg-purple-500/80 text-white text-xs px-2 py-1 rounded\">\n                    ðŸŽ¬ DEMO\n                  </div>\n                </>\n              ) : mediaStream ? (\n                <>\n                  <video\n                    ref={localVideoRef}\n                    autoPlay\n                    playsInline\n                    muted\n                    className=\"absolute inset-0 w-full h-full object-cover scale-x-[-1]\"\n                  />\n                  <div className=\"absolute top-2 left-2 flex gap-2\">\n                    <div className=\"bg-black/50 text-white text-xs px-2 py-1 rounded flex items-center gap-1\">\n                      <div className=\"w-2 h-2 bg-red-500 rounded-full animate-pulse\"></div>\n                      LIVE\n                    </div>\n                    {videoQuality && (\n                      <div className={`text-white text-xs px-2 py-1 rounded ${\n                        videoQuality === '4K UHD' \n                          ? 'bg-gradient-to-r from-purple-500 to-pink-500' \n                          : videoQuality === 'Full HD'\n                          ? 'bg-blue-500/80'\n                          : 'bg-green-500/80'\n                      }`}>\n                        {videoQuality}\n                      </div>\n                    )}\n                  </div>\n                </>\n              ) : (\n                <div className=\"absolute inset-0 w-full h-full bg-gradient-to-br from-blue-900/30 to-purple-900/30 flex items-center justify-center\">\n                  <div className=\"text-white/70 text-center space-y-2\">\n                    <div className=\"w-12 h-12 bg-white/10 rounded-full animate-pulse mx-auto\" />\n                    <p className=\"text-sm\">Starting camera...</p>\n                    {cameraError && (\n                      <p className=\"text-xs text-red-400\">{cameraError}</p>\n                    )}\n                  </div>\n                </div>\n              )\n            ) : (\n              <div className=\"w-full h-full flex flex-col items-center justify-center bg-gradient-to-br from-slate-900/40 to-purple-900/40 text-center px-4\">\n                <Avatar className=\"w-20 h-20 border-4 border-white/20 mb-3\">\n                  <AvatarImage src={participant.avatar} />\n                  <AvatarFallback>{participant.name[0] ?? '?'}</AvatarFallback>\n                </Avatar>\n                <p className=\"text-white text-sm font-semibold\">{participant.name}</p>\n                <p className=\"text-white/60 text-xs mt-1\">\n                  {participant.isVideoOff ? 'Camera off' : 'Streaming'}\n                </p>\n              </div>\n            )}\n            {participant.isSelf && isSoloParticipant && (\n              <div className=\"absolute bottom-3 left-3 bg-black/60 text-white/80 text-xs px-3 py-1 rounded-full\">\n                You&apos;re the first in the room\n              </div>\n            )}\n\n            {/* Participant Info Overlay */}\n            <div className=\"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/60 to-transparent p-3\">\n              <div className=\"flex items-center justify-between\">\n                <div className=\"flex items-center gap-2\">\n                  <span className=\"text-white text-sm\">{participant.name}</span>\n                  {participant.isSpeaking && (\n                    <div className=\"flex gap-0.5\">\n                      <div className=\"w-1 h-3 bg-green-400 rounded-full animate-pulse\"></div>\n                      <div className=\"w-1 h-4 bg-green-400 rounded-full animate-pulse animation-delay-150\"></div>\n                      <div className=\"w-1 h-3 bg-green-400 rounded-full animate-pulse animation-delay-300\"></div>\n                    </div>\n                  )}\n                </div>\n                <div className=\"flex items-center gap-1\">\n                  {participant.isMuted && (\n                    <div className=\"w-6 h-6 bg-red-500 rounded-full flex items-center justify-center\">\n                      <MicOff className=\"w-3 h-3 text-white\" />\n                    </div>\n                  )}\n                  {participant.isVideoOff && (\n                    <div className=\"w-6 h-6 bg-red-500 rounded-full flex items-center justify-center\">\n                      <VideoOff className=\"w-3 h-3 text-white\" />\n                    </div>\n                  )}\n                </div>\n              </div>\n            </div>\n\n            {/* More Options */}\n            <Button\n              size=\"sm\"\n              variant=\"ghost\"\n              className=\"absolute top-2 right-2 text-white/70 hover:text-white hover:bg-black/30 backdrop-blur-md\"\n            >\n              <MoreVertical className=\"w-4 h-4\" />\n            </Button>\n          </Card>\n        ))}\n      </div>\n\n      {/* Screen Share Overlay */}\n      {screenShareDemoMode && isScreenSharing && (\n        <div className=\"fixed inset-0 z-50 bg-black/90 flex items-center justify-center p-4\">\n          <div className=\"relative w-full max-w-6xl aspect-video\">\n            <canvas\n              ref={screenShareDemoCanvasRef}\n              width={1920}\n              height={1080}\n              className=\"w-full h-full object-contain rounded-lg border-2 border-green-400 shadow-2xl\"\n            />\n            <div className=\"absolute top-4 right-4 flex gap-2\">\n              <div className=\"bg-green-500/90 text-white px-4 py-2 rounded-lg backdrop-blur-md\">\n                ðŸ–¥ï¸ Demo Screen Share Active\n              </div>\n              <Button\n                onClick={handleToggleScreenShare}\n                className=\"bg-red-500 hover:bg-red-600 text-white\"\n              >\n                Stop Sharing\n              </Button>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Control Bar */}\n      <Card className=\"backdrop-blur-xl bg-white/10 border-white/20 p-4\">\n        <div className=\"flex items-center justify-between\">\n          {/* Left Controls */}\n          <div className=\"flex items-center gap-2\">\n            <div className=\"text-white/70 text-sm\">\n              <span className=\"text-white\">{callerName}</span> â€¢ {participantCount} participants\n            </div>\n          </div>\n\n          {/* Center Controls */}\n          <div className=\"flex items-center gap-2\">\n            <Button\n              onClick={handleToggleMute}\n              className={`rounded-full w-12 h-12 ${\n                isMuted \n                  ? 'bg-red-500 hover:bg-red-600' \n                  : 'bg-white/10 hover:bg-white/20'\n              } text-white border-0`}\n            >\n              {isMuted ? <MicOff className=\"w-5 h-5\" /> : <Mic className=\"w-5 h-5\" />}\n            </Button>\n\n            {callType === 'video' && (\n              <Button\n                onClick={handleToggleVideo}\n                className={`rounded-full w-12 h-12 ${\n                  isVideoOff \n                    ? 'bg-red-500 hover:bg-red-600' \n                    : 'bg-white/10 hover:bg-white/20'\n                } text-white border-0`}\n              >\n                {isVideoOff ? <VideoOff className=\"w-5 h-5\" /> : <Video className=\"w-5 h-5\" />}\n              </Button>\n            )}\n\n            <Button\n              onClick={handleToggleScreenShare}\n              className={`rounded-full w-12 h-12 ${\n                effectiveScreenShareActive\n                  ? 'bg-green-500 hover:bg-green-600'\n                  : 'bg-white/10 hover:bg-white/20'\n              } text-white border-0`}\n            >\n              {effectiveScreenShareActive ? <MonitorOff className=\"w-5 h-5\" /> : <Monitor className=\"w-5 h-5\" />}\n            </Button>\n\n            <Button\n              onClick={handleEndCall}\n              className=\"rounded-full w-12 h-12 bg-red-500 hover:bg-red-600 text-white border-0\"\n            >\n              <Phone className=\"w-5 h-5 rotate-135\" />\n            </Button>\n          </div>\n\n          {/* Right Controls */}\n          <div className=\"flex items-center gap-2\">\n            {!cameraAutoRetryEnabled && (\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={() => handleResumeCamera()}\n                className=\"text-yellow-200 hover:text-yellow-100 hover:bg-yellow-500/20\"\n                title=\"Try to reconnect the real camera feed\"\n              >\n                ðŸ”„ Resume Cam\n              </Button>\n            )}\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={handleToggleDemoMode}\n              className={`${\n                demoMode \n                  ? 'text-purple-400 hover:text-purple-300 bg-purple-500/20 hover:bg-purple-500/30' \n                  : 'text-white/70 hover:text-white hover:bg-white/10'\n              }`}\n              title=\"Toggle Camera Demo Mode (prevents camera conflicts with Zoom/Meet/Teams)\"\n            >\n              ðŸŽ¬ {demoMode ? 'Cam Demo ON' : 'Cam Demo'}\n            </Button>\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={handleToggleSafeStart}\n              className={`${\n                cameraSafeStart\n                  ? 'text-amber-300 hover:text-amber-200 bg-amber-500/20 hover:bg-amber-500/30'\n                  : 'text-white/70 hover:text-white hover:bg-white/10'\n              }`}\n              title=\"Always start MoveSplash in presentation-safe demo mode so other meeting apps keep your webcam\"\n            >\n              ðŸ›¡ï¸ {cameraSafeStart ? 'Safe Start ON' : 'Safe Start'}\n            </Button>\n\n            {multipleScreensDetected && (\n              <DropdownMenu>\n                <DropdownMenuTrigger asChild>\n                  <Button\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    className=\"text-white/70 hover:text-white hover:bg-white/10\"\n                    title=\"Choose which monitor or workspace to share by default\"\n                  >\n                    <Monitor className=\"w-5 h-5 mr-2\" />\n                    {monitorSelectionLabel}\n                  </Button>\n                </DropdownMenuTrigger>\n                <DropdownMenuContent className=\"bg-gradient-to-br from-purple-900 to-pink-900 border border-white/20 text-white\">\n                  {availableScreens.map((screen) => (\n                    <DropdownMenuItem\n                      key={screen.id}\n                      onClick={() => handleSelectScreenShareTarget(screen.id)}\n                      className=\"flex items-center justify-between gap-4 focus:bg-white/10 focus:text-white\"\n                    >\n                      <span>{screen.label}</span>\n                      <span className=\"text-xs text-white/60\">{screen.size}</span>\n                    </DropdownMenuItem>\n                  ))}\n                  <DropdownMenuItem\n                    onClick={() => handleSelectScreenShareTarget('all-monitors')}\n                    className=\"flex items-center justify-between gap-4 focus:bg-white/10 focus:text-white\"\n                  >\n                    <span>All Monitors</span>\n                    <span className=\"text-xs text-white/60\">Entire workspace</span>\n                  </DropdownMenuItem>\n                </DropdownMenuContent>\n              </DropdownMenu>\n            )}\n\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={handleToggleScreenShareDemoMode}\n              className={`${\n                screenShareDemoMode \n                  ? 'text-green-400 hover:text-green-300 bg-green-500/20 hover:bg-green-500/30' \n                  : 'text-white/70 hover:text-white hover:bg-white/10'\n              }`}\n              title=\"Toggle Screen Share Demo Mode (prevents screen share conflicts)\"\n            >\n              ðŸ–¥ï¸ {screenShareDemoMode ? 'Screen Demo ON' : 'Screen Demo'}\n            </Button>\n\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={() => setViewMode(viewMode === 'grid' ? 'speaker' : 'grid')}\n              className={`${\n                viewMode === 'grid'\n                  ? 'text-white/90 bg-white/15'\n                  : 'text-white/70 hover:text-white hover:bg-white/10'\n              }`}\n            >\n              <Grid3x3 className=\"w-5 h-5 mr-2\" />\n              {viewMode === 'grid' ? 'Grid' : 'Speaker'}\n            </Button>\n\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={() => togglePanel('participants')}\n              className={`${\n                showParticipantsPanel\n                  ? 'text-white/90 bg-white/15'\n                  : 'text-white/70 hover:text-white hover:bg-white/10'\n              }`}\n            >\n              <Users className=\"w-5 h-5 mr-2\" />\n              Participants\n            </Button>\n\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={() => togglePanel('chat')}\n              className={`${\n                showChatPanel\n                  ? 'text-white/90 bg-white/15'\n                  : 'text-white/70 hover:text-white hover:bg-white/10'\n              }`}\n            >\n              <MessageSquare className=\"w-5 h-5 mr-2\" />\n              Chat\n            </Button>\n\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={() => togglePanel('settings')}\n              className={`${\n                showSettingsPanel\n                  ? 'text-white/90 bg-white/15'\n                  : 'text-white/70 hover:text-white hover:bg-white/10'\n              }`}\n            >\n              <Settings className=\"w-5 h-5\" />\n            </Button>\n          </div>\n        </div>\n      </Card>\n\n      {/* Participants Drawer */}\n      {showParticipantsPanel && (\n        <Card className=\"fixed right-4 bottom-28 w-80 max-h-[420px] z-40 backdrop-blur-xl bg-slate-950/80 border-white/20 text-white shadow-2xl\">\n          <div className=\"flex items-center justify-between border-b border-white/10 px-4 py-3\">\n            <div>\n              <p className=\"text-sm text-white/70\">In the room</p>\n              <p className=\"text-lg font-semibold\">\n                {participantCount} participant{participantCount !== 1 ? 's' : ''}\n              </p>\n            </div>\n            <Button\n              size=\"icon\"\n              variant=\"ghost\"\n              onClick={() => setShowParticipantsPanel(false)}\n              className=\"text-white/70 hover:text-white\"\n            >\n              <X className=\"w-4 h-4\" />\n            </Button>\n          </div>\n          <div className=\"px-4 py-3 space-y-3 overflow-y-auto max-h-[340px]\">\n            {participants.map((participant) => (\n              <div\n                key={participant.userId}\n                className=\"flex items-center justify-between rounded-lg bg-white/5 px-3 py-2 border border-white/10\"\n              >\n                <div className=\"flex items-center gap-3\">\n                  <Avatar className=\"w-10 h-10\">\n                    <AvatarImage src={participant.avatar} />\n                    <AvatarFallback>{participant.name[0] ?? '?'}</AvatarFallback>\n                  </Avatar>\n                  <div className=\"space-y-0.5\">\n                    <p className=\"text-sm font-medium\">\n                      {participant.name} {participant.isSelf ? '(You)' : ''}\n                    </p>\n                    <div className=\"flex items-center gap-2 text-xs text-white/60\">\n                      {participant.isMuted ? (\n                        <span className=\"flex items-center gap-1\">\n                          <MicOff className=\"w-3 h-3\" /> Muted\n                        </span>\n                      ) : (\n                        <span className=\"flex items-center gap-1\">\n                          <Mic className=\"w-3 h-3\" /> Live\n                        </span>\n                      )}\n                      {participant.isVideoOff && (\n                        <span className=\"flex items-center gap-1\">\n                          <VideoOff className=\"w-3 h-3\" /> Cam off\n                        </span>\n                      )}\n                      {participant.isScreenSharing && (\n                        <span className=\"flex items-center gap-1\">\n                          <Monitor className=\"w-3 h-3\" /> Sharing\n                        </span>\n                      )}\n                    </div>\n                  </div>\n                </div>\n                <span className=\"text-[10px] text-white/50\">\n                  Joined{' '}\n                  {new Date(participant.joinedAt).toLocaleTimeString([], {\n                    hour: '2-digit',\n                    minute: '2-digit',\n                  })}\n                </span>\n              </div>\n            ))}\n          </div>\n        </Card>\n      )}\n\n      {/* Chat Drawer */}\n      {showChatPanel && (\n        <Card className=\"fixed right-4 bottom-28 w-[26rem] max-h-[460px] z-40 backdrop-blur-xl bg-slate-950/85 border-white/20 text-white shadow-2xl\">\n          <div className=\"flex items-center justify-between border-b border-white/10 px-4 py-3\">\n            <div>\n              <p className=\"text-sm text-white/70\">Meeting chat</p>\n              <p className=\"text-lg font-semibold\">Share quick notes & links</p>\n            </div>\n            <Button\n              size=\"icon\"\n              variant=\"ghost\"\n              onClick={() => setShowChatPanel(false)}\n              className=\"text-white/70 hover:text-white\"\n            >\n              <X className=\"w-4 h-4\" />\n            </Button>\n          </div>\n          <div ref={chatListRef} className=\"px-4 py-3 space-y-3 overflow-y-auto max-h-[320px]\">\n            {chatMessages.map((message) => (\n              <div\n                key={message.id}\n                className={`flex flex-col gap-1 rounded-lg px-3 py-2 border ${\n                  message.isSelf ? 'bg-purple-600/20 border-purple-400/30' : 'bg-white/5 border-white/10'\n                }`}\n              >\n                <div className=\"flex items-center justify-between text-xs text-white/60\">\n                  <span className=\"font-semibold text-white/80\">{message.author}</span>\n                  <span>\n                    {new Date(message.timestamp).toLocaleTimeString([], {\n                      hour: '2-digit',\n                      minute: '2-digit',\n                    })}\n                  </span>\n                </div>\n                <p className=\"text-sm text-white/90 whitespace-pre-wrap\">{message.text}</p>\n              </div>\n            ))}\n          </div>\n          <div className=\"border-t border-white/10 px-4 py-3\">\n            <div className=\"flex items-center gap-2\">\n              <Input\n                value={chatDraft}\n                onChange={(event) => setChatDraft(event.target.value)}\n                onKeyDown={(event) => {\n                  if (event.key === 'Enter' && !event.shiftKey) {\n                    event.preventDefault();\n                    handleSendChatMessage();\n                  }\n                }}\n                placeholder=\"Type a message to everyoneâ€¦\"\n                className=\"bg-white/5 border-white/10 text-white placeholder:text-white/50\"\n              />\n              <Button\n                onClick={handleSendChatMessage}\n                className=\"bg-purple-500 hover:bg-purple-600 text-white\"\n              >\n                Send\n              </Button>\n            </div>\n          </div>\n        </Card>\n      )}\n\n      {/* Settings Drawer */}\n      {showSettingsPanel && (\n        <Card className=\"fixed right-4 bottom-28 w-80 max-h-[460px] z-40 backdrop-blur-xl bg-slate-950/85 border-white/20 text-white shadow-2xl\">\n          <div className=\"flex items-center justify-between border-b border-white/10 px-4 py-3\">\n            <div>\n              <p className=\"text-sm text-white/70\">Quick settings</p>\n              <p className=\"text-lg font-semibold\">Tune your call</p>\n            </div>\n            <Button\n              size=\"icon\"\n              variant=\"ghost\"\n              onClick={() => setShowSettingsPanel(false)}\n              className=\"text-white/70 hover:text-white\"\n            >\n              <X className=\"w-4 h-4\" />\n            </Button>\n          </div>\n          <div className=\"px-4 py-3 space-y-3\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm font-semibold\">Camera Demo Mode</p>\n                <p className=\"text-xs text-white/60\">Use a safe simulated camera</p>\n              </div>\n              <Button\n                size=\"sm\"\n                variant=\"ghost\"\n                onClick={handleToggleDemoMode}\n                className={\n                  demoMode\n                    ? 'text-purple-300 bg-purple-500/20'\n                    : 'text-white/70 hover:text-white hover:bg-white/10'\n                }\n              >\n                {demoMode ? 'On' : 'Off'}\n              </Button>\n            </div>\n\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm font-semibold\">Screen Share Demo</p>\n                <p className=\"text-xs text-white/60\">Share a safe placeholder feed</p>\n              </div>\n              <Button\n                size=\"sm\"\n                variant=\"ghost\"\n                onClick={handleToggleScreenShareDemoMode}\n                className={\n                  screenShareDemoMode\n                    ? 'text-green-300 bg-green-500/20'\n                    : 'text-white/70 hover:text-white hover:bg-white/10'\n                }\n              >\n                {screenShareDemoMode ? 'On' : 'Off'}\n              </Button>\n            </div>\n\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm font-semibold\">Safe Start</p>\n                <p className=\"text-xs text-white/60\">Stay in demo when opening the app</p>\n              </div>\n              <Button\n                size=\"sm\"\n                variant=\"ghost\"\n                onClick={handleToggleSafeStart}\n                className={\n                  cameraSafeStart\n                    ? 'text-amber-200 bg-amber-500/20'\n                    : 'text-white/70 hover:text-white hover:bg-white/10'\n                }\n              >\n                {cameraSafeStart ? 'On' : 'Off'}\n              </Button>\n            </div>\n\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm font-semibold\">Layout</p>\n                <p className=\"text-xs text-white/60\">Switch between grid and speaker</p>\n              </div>\n              <div className=\"flex gap-2\">\n                <Button\n                  size=\"sm\"\n                  variant=\"ghost\"\n                  onClick={() => setViewMode('grid')}\n                  className={\n                    viewMode === 'grid'\n                      ? 'text-white bg-white/20'\n                      : 'text-white/70 hover:text-white hover:bg-white/10'\n                  }\n                >\n                  Grid\n                </Button>\n                <Button\n                  size=\"sm\"\n                  variant=\"ghost\"\n                  onClick={() => setViewMode('speaker')}\n                  className={\n                    viewMode === 'speaker'\n                      ? 'text-white bg-white/20'\n                      : 'text-white/70 hover:text-white hover:bg-white/10'\n                  }\n                >\n                  Speaker\n                </Button>\n              </div>\n            </div>\n\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm font-semibold\">Camera Health</p>\n                <p className=\"text-xs text-white/60\">Retry the real camera feed</p>\n              </div>\n              <Button\n                size=\"sm\"\n                variant=\"ghost\"\n                onClick={() => handleResumeCamera()}\n                className=\"text-white/80 hover:text-white hover:bg-white/10\"\n              >\n                Resume cam\n              </Button>\n            </div>\n          </div>\n        </Card>\n      )}\n\n      {/* Screen Share Indicator */}\n      {effectiveScreenShareActive && (\n        <Card className=\"absolute top-4 left-1/2 -translate-x-1/2 backdrop-blur-xl bg-green-500/90 border-green-400 px-4 py-2 z-50\">\n          <div className=\"flex items-center gap-2 text-white\">\n            <Monitor className=\"w-4 h-4\" />\n            <span className=\"text-sm\">You are sharing your screen</span>\n          </div>\n        </Card>\n      )}\n\n      <style>{`\n        .rotate-135 {\n          transform: rotate(135deg);\n        }\n        .animation-delay-150 {\n          animation-delay: 150ms;\n        }\n        .animation-delay-300 {\n          animation-delay: 300ms;\n        }\n      `}</style>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}}]
}